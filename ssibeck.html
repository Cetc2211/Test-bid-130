<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EvaluaciÃ³n SSI - CBTa 130</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f0f2f5; color: #1c1c1e; }
    /* Encabezado VIOLETA para SSI */
    header { background: linear-gradient(135deg, #4527a0 0%, #7b1fa2 100%); color: white; text-align: center; padding: 25px; font-weight: bold; font-size: 1.4rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    h2 { color: #4527a0; text-align: center; margin-top: 0; border-bottom: 2px solid #e1bee7; padding-bottom: 10px; }
    
    .input-group { margin-bottom: 15px; }
    label { font-weight: 600; display: block; margin-bottom: 8px; color: #333; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }

    .instructions { background-color: #f3e5f5; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 0.95em; line-height: 1.5; border-left: 5px solid #7b1fa2; }

    .question-card { background: #fff; border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 20px; transition: all 0.3s ease; }
    .question-title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; color: #2c0e58; }
    
    .option-label { display: flex; align-items: flex-start; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s; }
    .option-label:hover { background-color: #f5f5f5; }
    .option-label input { margin-right: 12px; margin-top: 4px; transform: scale(1.3); flex-shrink: 0; }
    .option-text { font-size: 0.95em; }

    .buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
    button { padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; color: white; cursor: pointer; width: 100%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .whatsapp { background-color: #25D366; }
    .reset { background-color: #757575; }

    #result-area { display: none; text-align: center; margin-top: 20px; padding: 20px; background: #f3e5f5; border-radius: 10px; }
    
    /* Clase para ocultar preguntas saltadas */
    .hidden { display: none; }
</style>
</head>
<body>

<header>CBTa No.130<br><span style="font-size:0.8em; font-weight:normal">Escala de IdeaciÃ³n (SSI)</span></header>

<div class="container">
    <div id="test-form">
        <h2>Datos del Alumno</h2>
        <div class="input-group"><label>Nombre Completo:</label><input type="text" id="nombre" required></div>
        <div class="input-group"><label>Fecha:</label><input type="date" id="fecha" required></div>

        <div class="instructions">
            <strong>Instrucciones:</strong> Lea cuidadosamente cada grupo de afirmaciones y elija la que mejor describa su actitud <strong>actual o mÃ¡s reciente</strong>.
        </div>

        <form id="ssiForm">
            <!-- PARTE I -->
            <div id="part1"></div>
            
            <!-- PARTE II, III, IV (Se ocultan si 4 y 5 son 0) -->
            <div id="conditional-block">
                <div style="text-align:center; color:#7b1fa2; margin:20px 0; font-weight:bold;">--- DETALLES DE LA IDEACIÃ“N ---</div>
                <div id="part234"></div>
            </div>

            <!-- PARTE V -->
            <div style="text-align:center; color:#7b1fa2; margin:20px 0; font-weight:bold;">--- ANTECEDENTES ---</div>
            <div id="part5"></div>
        </form>

        <div class="buttons">
            <button type="button" class="whatsapp" onclick="finalizarTest()">âœ… Finalizar y Enviar</button>
        </div>
    </div>

    <div id="result-area">
        <h3 style="color:#4527a0;">Â¡Registro Completado!</h3>
        <p>Sus respuestas han sido guardadas de forma confidencial.</p>
        <div class="buttons">
            <button type="button" class="whatsapp" onclick="enviarWhatsApp()">ðŸ“² Enviar ConfirmaciÃ³n</button>
            <button type="button" class="reset" onclick="location.reload()">ðŸ”„ Nuevo Test</button>
        </div>
    </div>
</div>

<script>
    const NUMERO_DESTINO = "523111477413"; 

    // DefiniciÃ³n de Items
    const itemsP1 = [
        { t: "1. Deseo de vivir", o: ["0 = Moderado a fuerte", "1 = DÃ©bil", "2 = Ninguno"] },
        { t: "2. Deseo de morir", o: ["0 = Ninguno", "1 = DÃ©bil", "2 = Moderado a fuerte"] },
        { t: "3. Razones para vivir/morir", o: ["0 = Vivir supera a morir", "1 = Iguales", "2 = Morir supera a vivir"] },
        { t: "4. Deseo de intento activo", o: ["0 = Ninguno", "1 = DÃ©bil", "2 = Moderado a fuerte"] },
        { t: "5. Deseo suicida pasivo", o: ["0 = TomarÃ­a precauciones para vivir", "1 = DejarÃ­a vida/muerte al azar", "2 = EvitarÃ­a salvarse"] }
    ];

    const itemsP234 = [
        { t: "6. DimensiÃ³n temporal", o: ["0 = Breve, pasajero", "1 = PerÃ­odos largos", "2 = Continuo"] },
        { t: "7. Frecuencia", o: ["0 = Rara, ocasional", "1 = Intermitente", "2 = Persistente"] },
        { t: "8. Actitud hacia la ideaciÃ³n", o: ["0 = Rechazo", "1 = Ambivalente", "2 = AceptaciÃ³n"] },
        { t: "9. Control sobre la acciÃ³n", o: ["0 = Tiene control", "1 = Inseguro", "2 = No tiene control"] },
        { t: "10. Factores disuasivos", o: ["0 = No lo harÃ­a (familia, etc)", "1 = Cierta preocupaciÃ³n", "2 = MÃ­nima preocupaciÃ³n"] },
        { t: "11. Razones del intento", o: ["0 = Manipular/AtenciÃ³n", "1 = CombinaciÃ³n", "2 = Escape/Finalizar problemas"] },
        { t: "12. MÃ©todo: PlanificaciÃ³n", o: ["0 = No considerado", "1 = No elaborado", "2 = Elaborado y detallado"] },
        { t: "13. MÃ©todo: Disponibilidad", o: ["0 = No disponible", "1 = Toma tiempo/esfuerzo", "2 = Disponible/Oportunidad presente"] },
        { t: "14. Sentido de capacidad", o: ["0 = No tiene valor/miedo", "1 = Inseguro", "2 = Seguro de tener valor"] },
        { t: "15. Expectativa de intento", o: ["0 = No", "1 = Incierto", "2 = SÃ­"] },
        { t: "16. PreparaciÃ³n real", o: ["0 = Ninguna", "1 = Parcial", "2 = Completa"] },
        { t: "17. Nota suicida", o: ["0 = No", "1 = Empezada", "2 = Completa"] },
        { t: "18. Actos finales", o: ["0 = Ninguno", "1 = Pensamientos", "2 = Arreglos definitivos"] },
        { t: "19. EngaÃ±o/Ocultamiento", o: ["0 = Abierto", "1 = EvitÃ³ tema", "2 = EngaÃ±Ã³/OcultÃ³"] }
    ];

    const itemsP5 = [
        { t: "20. Intentos previos", o: ["0 = Ninguno", "1 = Uno", "2 = MÃ¡s de uno"] },
        { t: "21. IntenciÃ³n en Ãºltimo intento", o: ["0 = Baja", "1 = Moderada", "2 = Alta"] }
    ];

    // Renderizar Preguntas
    function render(list, containerId, startIdx) {
        const div = document.getElementById(containerId);
        list.forEach((item, i) => {
            const num = startIdx + i;
            let html = `<div class="question-card"><div class="question-title">${item.t}</div>`;
            item.o.forEach((txt, val) => {
                // Agregar evento onchange solo a 4 y 5 para la lÃ³gica de salto
                const onChangeAttr = (num === 4 || num === 5) ? 'onchange="verificarSalto()"' : '';
                html += `<label class="option-label"><input type="radio" name="item${num}" value="${val}" ${onChangeAttr} required><span class="option-text">${txt}</span></label>`;
            });
            html += `</div>`;
            div.innerHTML += html;
        });
    }

    render(itemsP1, 'part1', 1);
    render(itemsP234, 'part234', 6);
    render(itemsP5, 'part5', 20);

    // LÃ³gica de Salto (Beck Skip Logic)
    function verificarSalto() {
        const q4 = document.querySelector('input[name="item4"]:checked');
        const q5 = document.querySelector('input[name="item5"]:checked');
        const block = document.getElementById('conditional-block');
        
        // Si ambos estÃ¡n contestados y ambos son 0, ocultar bloque
        if (q4 && q5 && q4.value === "0" && q5.value === "0") {
            block.style.display = 'none';
            // Limpiar valores del bloque oculto para no afectar suma si cambiaron de opiniÃ³n
            const inputs = block.querySelectorAll('input[type="radio"]');
            inputs.forEach(i => i.checked = false);
        } else {
            block.style.display = 'block';
        }
    }

    document.getElementById('fecha').valueAsDate = new Date();
    let datosFinales = null;

    function finalizarTest() {
        const nombre = document.getElementById('nombre').value;
        const fecha = document.getElementById('fecha').value;
        if(!nombre) { alert("Nombre requerido"); return; }

        let total = 0;
        let flags = [];
        let items4and5Zero = false;

        // Verificar 4 y 5
        const q4 = document.querySelector('input[name="item4"]:checked');
        const q5 = document.querySelector('input[name="item5"]:checked');
        
        if (!q4 || !q5) { alert("Por favor contesta al menos las primeras 5 preguntas."); return; }
        
        if (q4.value === "0" && q5.value === "0") items4and5Zero = true;

        // Sumar items 1-19
        for(let i=1; i<=19; i++) {
            // Si saltamos, ignoramos 6-19
            if (items4and5Zero && i >= 6) continue;

            const el = document.querySelector(`input[name="item${i}"]:checked`);
            if (el) {
                const val = parseInt(el.value);
                total += val;
                
                // Indicadores CrÃ­ticos
                if ((i === 4 || i === 5) && val >= 1) flags.push(`C${i}`);
                if (i === 12 && val === 2) flags.push("C12");
                if (i === 13 && val === 2) flags.push("C13");
                if (i === 15 && val === 2) flags.push("C15");
            } else if (!items4and5Zero) {
                // Si no se deben saltar, es obligatorio contestar
                alert(`Falta la pregunta ${i}`); return;
            }
        }

        // Revisar item 20 (Antecedentes)
        const q20 = document.querySelector('input[name="item20"]:checked');
        if(q20) {
            if (parseInt(q20.value) >= 1) flags.push("C20");
        } else { alert("Falta pregunta 20"); return; }
        
        const q21 = document.querySelector('input[name="item21"]:checked');
        if(!q21) { alert("Falta pregunta 21"); return; }

        datosFinales = { nombre, fecha, total, flags };
        
        document.getElementById('test-form').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        window.scrollTo(0,0);
    }

    function enviarWhatsApp() {
        if(!datosFinales) return;
        let m = `ðŸŸ£ *DATOS SSI*%0AðŸ‘¤ ${datosFinales.nombre}%0AðŸ“… ${datosFinales.fecha}%0AðŸ“Š Score: ${datosFinales.total}`;
        if(datosFinales.flags.length > 0) m += `%0AðŸš© Flags: ${datosFinales.flags.join(', ')}`;
        
        window.location.href = `https://wa.me/${NUMERO_DESTINO}?text=${m}`;
    }
</script>
</body>
</html>

