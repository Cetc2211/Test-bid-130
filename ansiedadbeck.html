<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluaci贸n BAI - CBTa 130</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background-color: #f2f2f7; color: #1c1c1e; }
    /* Encabezado Verde Institucional */
    header { background: linear-gradient(135deg, #1b5e20 0%, #2e7d32 100%); color: white; text-align: center; padding: 25px; font-weight: bold; font-size: 1.4rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    h2 { color: #2e7d32; text-align: center; margin-top: 0; border-bottom: 2px solid #e8f5e9; padding-bottom: 10px; }
    .input-group { margin-bottom: 15px; }
    label { font-weight: 600; display: block; margin-bottom: 8px; color: #333; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.95rem; }
    th { background-color: #e8f5e9; color: #1b5e20; padding: 10px; text-align: center; font-size: 0.9em; position: sticky; top: 0; }
    td { border-bottom: 1px solid #eee; padding: 12px 5px; text-align: center; }
    td:first-child { text-align: left; font-weight: 500; width: 45%; }
    tr:nth-child(even) { background-color: #fafafa; }
    .buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
    button { padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; color: white; cursor: pointer; width: 100%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .whatsapp { background-color: #25D366; }
    .pdf { background-color: #2e7d32; }
    .reset { background-color: #757575; }
    input[type="radio"] { transform: scale(1.4); margin: 5px; }
</style>
</head>
<body>
<header>CBTa No.130<br><span style="font-size:0.8em; font-weight:normal">Inventario de Ansiedad de Beck (BAI)</span></header>
<div class="container">
    <h2>Datos del Paciente</h2>
    <div class="input-group"><label>Nombre Completo:</label><input type="text" id="nombre" required></div>
    <div class="input-group"><label>Fecha:</label><input type="date" id="fecha" required></div>
    <p style="text-align:center; font-style:italic;">Instrucciones: Marque cu谩nto le ha molestado cada s铆ntoma la 煤ltima semana.</p>
    <table>
        <thead><tr><th>S铆ntoma</th><th>0</th><th>1</th><th>2</th><th>3</th></tr></thead>
        <tbody id="tabla-preguntas"></tbody>
    </table>
    <div class="buttons">
        <button type="button" class="whatsapp" onclick="enviarWhatsApp()"> Enviar Resultados</button>
        <button type="button" class="pdf" onclick="generarPDF()"> Descargar PDF</button>
        <button type="button" class="reset" onclick="location.reload()"> Limpiar</button>
    </div>
</div>
<script>
    const NUMERO_DESTINO = "523111477413"; 
    const preguntas = ["Entumecimiento", "Sensaci贸n de calor", "Temblor piernas", "Incapacidad relajarse", "Miedo a lo peor", "Mareo", "Palpitaciones", "Inestabilidad", "Terror", "Nerviosismo", "Sensaci贸n de ahogo", "Temblor manos", "Estremecimiento", "Miedo perder control", "Dificultad respirar", "Miedo a morir", "Asustado", "Indigesti贸n", "Desmayo", "Rubor facial", "Sudoraci贸n"];
    
    const tbody = document.getElementById('tabla-preguntas');
    preguntas.forEach((p, i) => {
        let html = `<tr><td>${i+1}. ${p}</td>${[0,1,2,3].map(v=>`<td><input type="radio" name="item${i+1}" value="${v}"></td>`).join('')}</tr>`;
        tbody.innerHTML += html;
    });
    document.getElementById('fecha').valueAsDate = new Date();

    function calcular() {
        const nombre = document.getElementById('nombre').value;
        const fecha = document.getElementById('fecha').value;
        if(!nombre) return null;
        let suma = 0, count = 0;
        for(let i=1; i<=21; i++){
            const el = document.querySelector(`input[name="item${i}"]:checked`);
            if(el) { suma += parseInt(el.value); count++; }
        }
        if(count<21) { alert("Faltan preguntas"); return null; }
        
        let nivel = suma<=21 ? "Ansiedad Muy Baja" : (suma<=35 ? "Ansiedad Moderada" : "Ansiedad Severa");
        return {nombre, fecha, suma, nivel};
    }

    function enviarWhatsApp(){
        const d = calcular(); if(!d) return;
        window.location.href = `https://wa.me/${NUMERO_DESTINO}?text=Resultados BAI - ${d.nombre}: ${d.suma} puntos (${d.nivel})`;
    }

    function generarPDF(){
        const d = calcular(); if(!d) return;
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const img = new Image(); img.src = "logo.jpg";
        img.onload = () => drawPDF(doc, d, img);
        img.onerror = () => drawPDF(doc, d, null);
    }

    function drawPDF(doc, d, img){
        doc.setFillColor(27, 94, 32); doc.rect(0,0,210,40,'F');
        if(img) doc.addImage(img,'JPEG',10,7,25,25);
        doc.setTextColor(255); doc.setFontSize(16); doc.text("CBTa No. 130",105,25,null,null,"center");
        doc.setTextColor(0); doc.text(`Paciente: ${d.nombre}`,20,60);
        doc.text(`Puntuaci贸n BAI: ${d.suma} - ${d.nivel}`,20,75);
        doc.save(`BAI_${d.nombre}.pdf`);
    }
</script>
</body>
</html>
