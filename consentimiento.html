<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consentimiento Informado - CBTa 130</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Iconos para botones -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
    /* Estilos generales de la App */
    body { font-family: "Segoe UI", sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; color: #333; }
    
    /* Estilos de la HOJA DE PAPEL (Para vista previa e impresión) */
    .paper { 
        background: white; 
        max-width: 816px; /* Ancho carta aprox */
        margin: 0 auto 80px auto; 
        padding: 40px 50px; 
        box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
        font-family: "Times New Roman", serif; /* Fuente formal */
    }

    /* Elementos del Formulario en Papel */
    .header-doc { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px; }
    .header-doc h1 { font-size: 14pt; margin: 0; font-weight: bold; }
    .header-doc h2 { font-size: 11pt; margin: 5px 0; font-weight: normal; }
    
    .section-title { 
        background: #eee; padding: 4px 10px; font-weight: bold; border: 1px solid #000; 
        margin-top: 15px; margin-bottom: 10px; text-transform: uppercase; font-size: 10pt; 
    }
    
    .row { display: flex; gap: 15px; margin-bottom: 8px; align-items: flex-end; }
    .col { flex: 1; }
    
    label { font-weight: bold; font-size: 10pt; color: #000; }
    
    /* Inputs "invisibles" para que parezca documento */
    input[type="text"], input[type="number"], input[type="date"] { 
        width: 100%; border: none; border-bottom: 1px solid #999; background: transparent; 
        font-family: "Courier New", monospace; font-size: 11pt; padding: 2px; color: #000;
        transition: border-color 0.3s;
    }
    input:focus { outline: none; border-bottom: 2px solid #1976D2; background: #e3f2fd; }

    .check-group { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 10pt; }
    .check-item { display: flex; align-items: center; gap: 8px; cursor: pointer; }
    input[type="checkbox"], input[type="radio"] { cursor: pointer; }

    p { text-align: justify; margin-bottom: 8px; font-size: 10.5pt; line-height: 1.3; }

    /* Área de Firma */
    .signature-area { 
        border: 2px dashed #ccc; padding: 15px; text-align: center; margin-top: 10px; 
        background: #fafafa; border-radius: 8px; cursor: pointer; transition: background 0.3s;
    }
    .signature-area:hover { background: #f0f0f0; border-color: #999; }
    .signature-preview { max-height: 60px; margin-top: 5px; display: none; }

    /* Botones Flotantes (FAB) */
    .fab-container { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 100; }
    .btn-fab { 
        border: none; padding: 12px 20px; border-radius: 50px; font-weight: bold; cursor: pointer; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: transform 0.2s; display: flex; align-items: center; gap: 8px; font-family: "Segoe UI", sans-serif;
    }
    .btn-fab:hover { transform: translateY(-2px); }
    .btn-pdf { background: #d32f2f; color: white; }
    .btn-home { background: #263238; color: white; }

    /* Ocultar botones al imprimir con Ctrl+P */
    @media print { .fab-container { display: none; } body { background: white; padding: 0; } .paper { box-shadow: none; margin: 0; } }
</style>
</head>
<body>

<!-- BOTONES DE ACCIÓN -->
<div class="fab-container">
    <button class="btn-fab btn-pdf" onclick="generarPDFOficial()">
        <i class="ph-bold ph-file-pdf text-xl"></i> Descargar PDF
    </button>
    <button class="btn-fab btn-home" onclick="location.href='index.html'">
        <i class="ph-bold ph-house text-xl"></i> Volver al Menú
    </button>
</div>

<!-- DOCUMENTO -->
<div class="paper" id="documento-impresion">
    
    <div class="header-doc">
        <h1>Centro de Bachillerato Tecnológico Agropecuario No. 130</h1>
        <h2>"Guadalupe Victoria", San Blas, Nayarit</h2>
        <div style="margin-top:8px; font-weight:bold; font-size:11pt;">CONSENTIMIENTO INFORMADO: ORIENTACIÓN EDUCATIVA</div>
    </div>

    <div style="text-align:right; margin-bottom:10px; font-size:10pt;">
        <strong>Folio:</strong> <input type="text" id="folio" style="width:80px; display:inline-block; text-align:center;"> 
        <strong>Fecha:</strong> <input type="date" id="fecha" style="width:130px; display:inline-block;">
    </div>

    <!-- SECCIÓN DATOS -->
    <div class="section-title">I. DATOS DE IDENTIFICACIÓN</div>
    <div class="row">
        <div class="col" style="flex:3">
            <label>Estudiante:</label>
            <input type="text" id="nombreEstudiante" placeholder="Nombre completo">
        </div>
        <div class="col">
            <label>Edad:</label>
            <input type="number" id="edad">
        </div>
        <div class="col">
            <label>Grupo:</label>
            <input type="text" id="grupo">
        </div>
    </div>
    <div class="row">
        <div class="col" style="flex:2">
            <label>Especialidad:</label>
            <input type="text" id="especialidad">
        </div>
        <div class="col">
            <label>Semestre:</label>
            <input type="text" id="semestre">
        </div>
        <div class="col" style="flex:1.5">
            <label>CURP:</label>
            <input type="text" id="curp">
        </div>
    </div>
    <div class="row">
        <div class="col" style="flex:2">
            <label>Padre/Madre/Tutor:</label>
            <input type="text" id="tutor">
        </div>
        <div class="col">
            <label>Teléfono:</label>
            <input type="text" id="telefono">
        </div>
    </div>
    <div class="row">
        <div class="col" style="flex:2">
            <label>Responsable:</label>
            <input type="text" id="profesional" value="Psic. Cecilio Topete Cruz">
        </div>
        <div class="col">
            <label>Cédula:</label>
            <input type="text" id="cedula">
        </div>
    </div>

    <!-- SECCIÓN INFORMACIÓN -->
    <div class="section-title">II. DETALLES DEL SERVICIO</div>
    <p>Se informa que el estudiante recibirá atención del Departamento de Orientación Educativa con los siguientes fines:</p>
    
    <div style="margin-bottom:5px; font-weight:bold; font-size:10pt;">MOTIVO DE ATENCIÓN:</div>
    <div class="check-group">
        <label class="check-item"><input type="checkbox" id="m1"> Rendimiento Académico</label>
        <label class="check-item"><input type="checkbox" id="m5"> Orientación Vocacional</label>
        <label class="check-item"><input type="checkbox" id="m2"> Atención/Concentración</label>
        <label class="check-item"><input type="checkbox" id="m6"> Tamizaje Preventivo</label>
        <label class="check-item"><input type="checkbox" id="m3"> Aspectos Emocionales</label>
        <label class="check-item"><input type="checkbox" id="m7"> Solicitud Padres/Alumno</label>
        <label class="check-item"><input type="checkbox" id="m4"> Conducta Escolar</label>
        <label class="check-item"><input type="checkbox" id="m8"> Otro: <input type="text" id="motivoOtro" style="width:100px; border-bottom:1px solid #000;"></label>
    </div>

    <div style="margin-top:10px; font-weight:bold; font-size:10pt;">PROCEDIMIENTOS APLICABLES:</div>
    <div class="check-group" style="grid-template-columns: 1fr 1fr 1fr;">
        <label class="check-item"><input type="checkbox" id="p1"> Entrevista Alumno</label>
        <label class="check-item"><input type="checkbox" id="p3"> Pruebas Psicológicas</label>
        <label class="check-item"><input type="checkbox" id="i1"> Consejería Breve</label>
        <label class="check-item"><input type="checkbox" id="p2"> Entrevista Padres</label>
        <label class="check-item"><input type="checkbox" id="p7"> Observación Áulica</label>
        <label class="check-item"><input type="checkbox" id="i5"> Taller Grupal</label>
    </div>

    <!-- SECCIÓN LEGAL -->
    <div class="section-title">III. CONFIDENCIALIDAD Y ACUERDO</div>
    <p>La información recabada es <strong>CONFIDENCIAL</strong> y se resguarda bajo ética profesional. Solo se compartirá información estrictamente necesaria para el bienestar del alumno en casos de riesgo o requerimiento legal.</p>
    
    <div style="background:#e8eaf6; padding:10px 15px; border:1px solid #3f51b5; margin:15px 0; border-radius:4px;">
        <label style="display:block; margin-bottom:5px; font-weight:bold;">DECLARACIÓN:</label>
        <div style="display:flex; gap:30px;">
            <label class="check-item"><input type="radio" name="consent" value="SI" checked> <strong>SÍ AUTORIZO</strong> la evaluación e intervención.</label>
            <label class="check-item"><input type="radio" name="consent" value="NO"> <strong>NO AUTORIZO</strong>.</label>
        </div>
    </div>

    <!-- FIRMAS -->
    <div class="row" style="margin-top:40px; gap:40px;">
        <div class="col" style="text-align:center;">
            <div style="border-bottom:1px solid #000; height:30px;"></div>
            <label style="font-size:9pt;">Firma del Estudiante</label>
        </div>
        <div class="col" style="text-align:center;">
            <div style="border-bottom:1px solid #000; height:30px;"></div>
            <label style="font-size:9pt;">Firma del Padre/Madre/Tutor</label>
        </div>
    </div>

    <div class="row" style="margin-top:20px; justify-content:center;">
        <div class="col" style="text-align:center; max-width:300px;">
            <!-- Input oculto para firma imagen -->
            <input type="file" id="firmaInput" accept="image/*" style="display:none;">
            
            <div class="signature-area" onclick="document.getElementById('firmaInput').click()">
                <div id="firmaPlaceholder" style="color:#1976D2; font-size:9pt;">
                    <i class="ph-bold ph-signature"></i> Clic para subir firma digital
                </div>
                <img id="firmaPreview" class="signature-preview">
            </div>
            
            <div style="border-bottom:1px solid #000; margin-top:5px;"></div>
            <label style="font-size:9pt;">Firma del Orientador(a)</label>
        </div>
    </div>

</div>

<script>
    // Inicializar fecha y folio
    document.getElementById('fecha').valueAsDate = new Date();
    document.getElementById('folio').value = "EXP-" + Math.floor(Math.random() * 10000);

    // Manejo de Firma Digital
    const firmaInput = document.getElementById('firmaInput');
    const firmaPreview = document.getElementById('firmaPreview');
    const firmaPlaceholder = document.getElementById('firmaPlaceholder');
    let firmaBase64 = null;

    firmaInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                firmaPreview.src = e.target.result;
                firmaPreview.style.display = "inline-block";
                firmaPlaceholder.style.display = "none";
                firmaBase64 = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    });

    // GENERAR PDF
    function generarPDFOficial() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'letter'); // Tamaño carta
        
        // Función auxiliar para obtener valores
        const val = (id) => document.getElementById(id).value.toUpperCase() || " ";
        const chk = (id) => document.getElementById(id).checked ? "X" : " ";

        // Configuración de fuente
        doc.setFont("times", "normal");
        
        // --- 1. ENCABEZADO ---
        doc.setFontSize(14); doc.setFont("times", "bold");
        doc.text("CENTRO DE BACHILLERATO TECNOLÓGICO AGROPECUARIO No. 130", 108, 15, null, null, "center");
        doc.setFontSize(11);
        doc.text('"GUADALUPE VICTORIA", SAN BLAS, NAYARIT', 108, 20, null, null, "center");
        doc.setFontSize(12);
        doc.text("CONSENTIMIENTO INFORMADO", 108, 28, null, null, "center");

        // Folio y Fecha
        doc.setFontSize(10); doc.setFont("times", "normal");
        doc.text(`FOLIO: ${val('folio')}`, 150, 35);
        doc.text(`FECHA: ${val('fecha')}`, 150, 40);

        let y = 45;

        // Función para dibujar títulos de sección
        const section = (title) => {
            doc.setFillColor(230); // Gris claro
            doc.rect(15, y, 185, 6, 'F');
            doc.setFont("times", "bold");
            doc.text(title, 17, y + 4);
            y += 10;
            doc.setFont("times", "normal");
        };

        // --- 2. DATOS ---
        section("I. DATOS DE IDENTIFICACIÓN");
        
        // Filas de datos
        doc.text(`Estudiante: ${val('nombreEstudiante')}`, 20, y);
        doc.text(`Edad: ${val('edad')}`, 140, y);
        doc.text(`Grupo: ${val('grupo')}`, 165, y);
        y += 6;
        
        doc.text(`Especialidad: ${val('especialidad')}`, 20, y);
        doc.text(`Semestre: ${val('semestre')}`, 100, y);
        doc.text(`CURP: ${val('curp')}`, 140, y);
        y += 6;

        doc.text(`Padre/Tutor: ${val('tutor')}`, 20, y);
        doc.text(`Teléfono: ${val('telefono')}`, 140, y);
        y += 6;

        doc.text(`Responsable: ${val('profesional')}`, 20, y);
        doc.text(`Cédula: ${val('cedula')}`, 140, y);
        y += 10;

        // --- 3. SERVICIO ---
        section("II. DETALLES DEL SERVICIO");
        doc.text("El estudiante recibirá atención del Depto. de Orientación con los siguientes fines:", 20, y);
        y += 6;

        doc.setFont("times", "bold"); doc.text("Motivo:", 20, y); doc.setFont("times", "normal");
        // Columna 1
        doc.text(`[ ${chk('m1')} ] Rendimiento Académico`, 40, y);
        doc.text(`[ ${chk('m2')} ] Atención/Concentración`, 40, y+5);
        doc.text(`[ ${chk('m3')} ] Emocional`, 40, y+10);
        doc.text(`[ ${chk('m4')} ] Conducta`, 40, y+15);
        // Columna 2
        doc.text(`[ ${chk('m5')} ] Vocacional`, 110, y);
        doc.text(`[ ${chk('m6')} ] Tamizaje`, 110, y+5);
        doc.text(`[ ${chk('m7')} ] Solicitud`, 110, y+10);
        doc.text(`[ ${chk('m8')} ] Otro: ${val('motivoOtro')}`, 110, y+15);
        y += 22;

        doc.setFont("times", "bold"); doc.text("Procedimientos:", 20, y); doc.setFont("times", "normal");
        // Una sola línea para ahorrar espacio
        doc.text(`[ ${chk('p1')} ] Entrevista Alumno   [ ${chk('p2')} ] Ent. Padres   [ ${chk('p3')} ] Pruebas   [ ${chk('i1')} ] Consejería`, 40, y);
        y += 12;

        // --- 4. LEGAL ---
        section("III. ACUERDO Y FIRMAS");
        const textoLegal = "La información es confidencial y se usará para fines de apoyo educativo y psicológico. Autorizo al departamento a realizar las intervenciones necesarias.";
        const splitText = doc.splitTextToSize(textoLegal, 180);
        doc.text(splitText, 20, y);
        y += 15;

        // Cuadro de autorización
        const autoriza = document.querySelector('input[name="consent"]:checked').value === "SI";
        doc.setDrawColor(0);
        doc.rect(40, y, 130, 10);
        doc.setFont("times", "bold");
        doc.text(autoriza ? "X   SÍ AUTORIZO" : "    SÍ AUTORIZO", 50, y+7);
        doc.text(!autoriza ? "X   NO AUTORIZO" : "    NO AUTORIZO", 110, y+7);
        y += 30;

        // FIRMAS
        doc.line(30, y, 90, y); // Línea 1
        doc.line(120, y, 180, y); // Línea 2
        y += 5;
        doc.setFont("times", "normal");
        doc.text("Firma del Estudiante", 45, y);
        doc.text("Firma Padre/Tutor", 135, y);

        y += 25; // Espacio firma responsable

        // Insertar imagen de firma si existe
        if (firmaBase64) {
            doc.addImage(firmaBase64, 'PNG', 85, y-20, 40, 15);
        }

        doc.line(75, y, 135, y); // Línea Responsable
        y += 5;
        doc.text("Firma Orientador(a)", 90, y);

        // Guardar
        doc.save(`Consentimiento_${val('nombreEstudiante').replace(/\s+/g, '_')}.pdf`);
    }
</script>

</body>
</html>

