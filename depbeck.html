<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EvaluaciÃ³n BDI-II - CBTa 130</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background-color: #f0f2f5; color: #1c1c1e; }
    header { background: linear-gradient(135deg, #1565C0 0%, #1976D2 100%); color: white; text-align: center; padding: 25px; font-weight: bold; font-size: 1.4rem; }
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    h2 { color: #1565C0; text-align: center; border-bottom: 2px solid #e3f2fd; padding-bottom: 10px; }
    .input-group { margin-bottom: 15px; }
    label { font-weight: 600; display: block; margin-bottom: 8px; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    .question-card { background: #fff; border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
    .question-title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; }
    .option-label { display: flex; align-items: flex-start; padding: 10px; cursor: pointer; border-radius: 6px; }
    .option-label:hover { background-color: #f5f5f5; }
    .option-label input { margin-right: 12px; transform: scale(1.3); flex-shrink: 0; }
    .buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
    button { padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; color: white; cursor: pointer; width: 100%; }
    .whatsapp { background-color: #25D366; }
    .local-save { background-color: #1565C0; }
    .reset { background-color: #757575; }
    #result-area { display: none; text-align: center; margin-top: 20px; padding: 20px; background: #e3f2fd; border-radius: 10px; }
</style>
</head>
<body>
<header>CBTa No.130<br><span style="font-size:0.8em;">Inventario de DepresiÃ³n (BDI-II)</span></header>
<div class="container">
    <div id="test-form">
        <h2>Datos del Alumno</h2>
        <div class="input-group"><label>Nombre:</label><input type="text" id="nombre" required></div>
        <div class="input-group"><label>Edad:</label><input type="number" id="edad" required></div>
        <div class="input-group"><label>Fecha:</label><input type="date" id="fecha" required></div>
        <div id="cuestionario"></div>
        <div class="buttons"><button type="button" class="whatsapp" onclick="finalizarTest()">âœ… Finalizar</button></div>
    </div>
    <div id="result-area">
        <h3 style="color:#1565C0;">Resultados Listos</h3>
        <div class="buttons">
            <button type="button" class="local-save" onclick="guardarLocalmente()">ðŸ’¾ Guardar en Expediente</button>
            <button type="button" class="whatsapp" onclick="enviarWhatsApp()">ðŸ“² Enviar WhatsApp</button>
            <button type="button" class="reset" onclick="location.reload()">ðŸ”„ Nuevo</button>
        </div>
    </div>
</div>
<script>
    const NUMERO_DESTINO = "523111477413"; 
    const STORAGE_KEY = "cbta_paciente_temp";

    const items = [
        { t: "1. Tristeza", o: ["No triste", "Triste gran parte", "Triste todo el tiempo", "Tan triste que no soporto"] },
        { t: "2. Pesimismo", o: ["No desalentado", "MÃ¡s desalentado", "Sin esperanza", "Futuro desesperanzador"] },
        // ... (Se asume que pegas aquÃ­ los 21 items completos que te di antes para ahorrar espacio visual)
        // NOTA: Pega aquÃ­ la lista completa de items si lo necesitas, o usa el archivo anterior y solo cambia el script final.
        // Para que funcione directo, pongo los placeholders funcionales:
        { t: "3. Fracaso", o: ["No fracasado", "He fracasado mÃ¡s", "Muchos fracasos", "Fracaso total"] },
        { t: "4. PÃ©rdida de Placer", o: ["Igual placer", "No disfruto tanto", "Muy poco placer", "NingÃºn placer"] },
        { t: "5. Culpa", o: ["No culpable", "Culpable a veces", "Bastante culpable", "Culpable siempre"] },
        { t: "6. Castigo", o: ["No castigado", "PodrÃ­a ser", "Espero ser", "Siento castigo"] },
        { t: "7. Disconformidad", o: ["Igual", "Menos confianza", "Decepcionado", "No me gusto"] },
        { t: "8. AutocrÃ­tica", o: ["No critico", "MÃ¡s crÃ­tico", "Critico errores", "Me culpo todo"] },
        { t: "9. Suicidio", o: ["No pensamientos", "Pensamientos pero no harÃ­a", "Me gustarÃ­a", "Me suicidarÃ­a"] },
        { t: "10. Llanto", o: ["No mÃ¡s", "MÃ¡s de lo usual", "Por pequeÃ±eces", "Ganas pero no puedo"] },
        { t: "11. AgitaciÃ³n", o: ["No", "MÃ¡s inquieto", "DifÃ­cil quieto", "Moverme siempre"] },
        { t: "12. InterÃ©s", o: ["No perdido", "Menos interÃ©s", "Perdido casi todo", "DifÃ­cil interesar"] },
        { t: "13. IndecisiÃ³n", o: ["Decido igual", "MÃ¡s difÃ­cil", "Mucha dificultad", "Imposible decidir"] },
        { t: "14. DesvalorizaciÃ³n", o: ["No inÃºtil", "No tan valioso", "Menos valioso", "InÃºtil"] },
        { t: "15. EnergÃ­a", o: ["Igual", "Menos", "Insuficiente", "Sin energÃ­a"] },
        { t: "16. SueÃ±o", o: ["Sin cambio", "Algo mÃ¡s/menos", "Mucho mÃ¡s/menos", "Mayor parte/despierto"] },
        { t: "17. Irritabilidad", o: ["No", "MÃ¡s", "Mucho mÃ¡s", "Todo el tiempo"] },
        { t: "18. Apetito", o: ["Sin cambio", "Algo +/-", "Mucho +/-", "Nada/Todo"] },
        { t: "19. ConcentraciÃ³n", o: ["Igual", "No tan bien", "DifÃ­cil", "Nada"] },
        { t: "20. Cansancio", o: ["No mÃ¡s", "MÃ¡s fÃ¡cil", "Demasiado", "Casi todo"] },
        { t: "21. Sexo", o: ["Sin cambios", "Menos", "Mucho menos", "Perdido"] }
    ];

    const divCuestionario = document.getElementById('cuestionario');
    items.forEach((item, index) => {
        const num = index + 1;
        let html = `<div class="question-card"><div class="question-title">${item.t}</div>`;
        item.o.forEach((txt, val) => html += `<label class="option-label"><input type="radio" name="item${num}" value="${val}"> <span style="font-size:0.9em">${val} - ${txt}</span></label>`);
        html += `</div>`;
        divCuestionario.innerHTML += html;
    });
    document.getElementById('fecha').valueAsDate = new Date();
    let datosFinales = null;

    function finalizarTest() {
        const nombre = document.getElementById('nombre').value;
        const edad = document.getElementById('edad').value;
        const fecha = document.getElementById('fecha').value;
        if (!nombre || !edad) { alert("Datos incompletos"); return; }
        let total = 0, count = 0, alertas = [];
        for (let i = 1; i <= 21; i++) {
            const el = document.querySelector(`input[name="item${i}"]:checked`);
            if (el) {
                let val = parseInt(el.value); total += val; count++;
                if (i === 9 && val >= 1) alertas.push("A9"); 
            }
        }
        if (count < 21) { alert("Faltan preguntas"); return; }
        datosFinales = { nombre, edad, fecha, total, alertas };
        document.getElementById('test-form').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        window.scrollTo(0,0);
    }

    function guardarLocalmente() {
        if(!datosFinales) return;
        let current = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        let update = { 
            ...current, 
            nombre: datosFinales.nombre,
            edad: datosFinales.edad,
            bdi: datosFinales.total // Se guarda en 'bdi'
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(update));
        alert("âœ… Datos de DEPRESIÃ“N guardados.");
    }

    function enviarWhatsApp() {
        if(!datosFinales) return;
        let m = `ðŸ“‹ *BDI-II*%0AðŸ‘¤ ${datosFinales.nombre} (${datosFinales.edad})%0AðŸ“Š Puntos: ${datosFinales.total}`;
        if (datosFinales.alertas.length > 0) m += `%0AðŸš©: ${datosFinales.alertas.join(', ')}`;
        window.location.href = `https://wa.me/${NUMERO_DESTINO}?text=${m}`;
    }
</script>
</body>
</html>


