<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluaci√≥n Columbia - CBTa 130</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background-color: #ffebee; color: #1c1c1e; }
    header { background: linear-gradient(135deg, #c62828 0%, #d32f2f 100%); color: white; text-align: center; padding: 25px; font-weight: bold; font-size: 1.4rem; }
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    h2 { color: #c62828; text-align: center; margin-top: 0; border-bottom: 2px solid #ffcdd2; padding-bottom: 10px; }
    .input-group { margin-bottom: 15px; }
    label { font-weight: 600; display: block; margin-bottom: 8px; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    .question-block { background: #fff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #e57373; }
    .q-text { font-weight: bold; font-size: 1.1em; margin-bottom: 15px; color: #b71c1c; }
    .yes-no-group { display: flex; gap: 20px; }
    .yn-label { display: flex; align-items: center; padding: 15px 25px; border: 2px solid #eee; border-radius: 8px; cursor: pointer; font-weight: bold; flex: 1; justify-content: center; }
    .yn-label:hover { background: #fafafa; }
    input[type="radio"] { display: none; }
    .yn-label.si:has(input:checked) { border-color: #c62828; background: #ffebee; color: #c62828; }
    .yn-label.no:has(input:checked) { border-color: #2e7d32; background: #e8f5e9; color: #2e7d32; }
    .buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
    button { padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; color: white; cursor: pointer; width: 100%; }
    .whatsapp { background-color: #25D366; }
    .local-save { background-color: #1565C0; }
    .btn-back { background-color: #78909c; }
    #hidden-section { display: none; }
</style>
</head>
<body>
<header>CBTa No.130<br><span style="font-size:0.8em;">Escala Columbia (C-SSRS)</span></header>
<div class="container">
    <div id="test-form">
        <h2>Datos del Alumno</h2>
        <div class="input-group"><label>Nombre:</label><input type="text" id="nombre" required></div>
        <div class="input-group"><label>Fecha:</label><input type="date" id="fecha" required></div>
        <div style="background-color:#ffebee; padding:15px; border-radius:8px; margin:20px 0; font-size:0.9em; border-left:5px solid #c62828;">
            <strong>Instrucciones:</strong> Responda con honestidad sobre el <strong>√öLTIMO MES</strong>.
        </div>
        <div class="question-block"><div class="q-text">1. ¬øHa deseado estar muerto?</div><div class="yes-no-group"><label class="yn-label si"><input type="radio" name="q1" value="SI">SI</label><label class="yn-label no"><input type="radio" name="q1" value="NO">NO</label></div></div>
        <div class="question-block"><div class="q-text">2. ¬øHa tenido pensamientos de suicidio?</div><div class="yes-no-group"><label class="yn-label si"><input type="radio" name="q2" value="SI" onchange="checkQ2()">SI</label><label class="yn-label no"><input type="radio" name="q2" value="NO" onchange="checkQ2()">NO</label></div></div>
        <div id="hidden-section">
            <div class="question-block"><div class="q-text">3. ¬øPensado m√©todo?</div><div class="yes-no-group"><label class="yn-label si"><input type="radio" name="q3" value="SI">SI</label><label class="yn-label no"><input type="radio" name="q3" value="NO">NO</label></div></div>
            <div class="question-block"><div class="q-text">4. ¬øIntenci√≥n de actuar?</div><div class="yes-no-group"><label class="yn-label si"><input type="radio" name="q4" value="SI">SI</label><label class="yn-label no"><input type="radio" name="q4" value="NO">NO</label></div></div>
            <div class="question-block"><div class="q-text">5. ¬øPlan espec√≠fico?</div><div class="yes-no-group"><label class="yn-label si"><input type="radio" name="q5" value="SI">SI</label><label class="yn-label no"><input type="radio" name="q5" value="NO">NO</label></div></div>
        </div>
        <div class="question-block" style="border-left-color:#000;"><div class="q-text">6. CONDUCTA: ¬øHa hecho algo alguna vez?</div><div class="yes-no-group"><label class="yn-label si"><input type="radio" name="q6" value="SI" onchange="checkQ6()">SI</label><label class="yn-label no"><input type="radio" name="q6" value="NO" onchange="checkQ6()">NO</label></div></div>
        <div class="question-block" id="q6b-block" style="display:none; background:#fff3e0;"><div class="q-text">¬øEn √∫ltimos 3 meses?</div><div class="yes-no-group"><label class="yn-label si"><input type="radio" name="q6b" value="SI">SI</label><label class="yn-label no"><input type="radio" name="q6b" value="NO">NO</label></div></div>
        <div class="buttons">
            <button type="button" class="whatsapp" onclick="finalizarTest()">üö® Finalizar</button>
            <button type="button" class="btn-back" onclick="window.location.href='index.html'">‚Ü©Ô∏è Cancelar y Volver</button>
        </div>
    </div>
</div>
<script>
    const NUMERO_DESTINO = "523111477413"; const STORAGE_KEY = "cbta_paciente_temp";
    function checkQ2() { const v = document.querySelector('input[name="q2"]:checked').value; document.getElementById('hidden-section').style.display = (v==="SI"?"block":"none"); }
    function checkQ6() { const v = document.querySelector('input[name="q6"]:checked').value; document.getElementById('q6b-block').style.display = (v==="SI"?"block":"none"); }
    document.getElementById('fecha').valueAsDate = new Date();
    function finalizarTest() {
        const nombre = document.getElementById('nombre').value; if(!nombre) { alert("Nombre"); return; }
        const getV = (n) => { const el = document.querySelector(`input[name="${n}"]:checked`); return el ? (el.value==="SI"?"1":"0") : "0"; };
        // Mapeo para Admin (1=SI, 0=NO)
        const d = { nombre, cId: getV('q2'), cPlan: getV('q5'), cCond: getV('q6'), cRec: getV('q6b') };
        
        // Guardar Auto
        let cur = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        let up = { ...cur, ...d }; localStorage.setItem(STORAGE_KEY, JSON.stringify(up));
        
        // WhatsApp
        let m = `üö® *COLUMBIA*%0Aüë§ ${nombre}%0A1. Deseo: ${getV('q1')}%0A2. Ideas: ${getV('q2')}`;
        if(getV('q2')==="1") m+=`%0A3.Metodo:${getV('q3')} 4.Int:${getV('q4')} 5.Plan:${getV('q5')}`;
        m+=`%0A6. Conducta: ${getV('q6')} (Reciente: ${getV('q6b')})`;
        
        if(confirm("‚úÖ Datos guardados internamente.\n¬øEnviar alerta por WhatsApp?")) {
            window.open(`https://wa.me/${NUMERO_DESTINO}?text=${m}`, '_blank');
        }
        window.location.href = 'index.html';
    }
</script>
</body>
</html>


