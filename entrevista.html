<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entrevista Cl칤nica Integral - CBTa 130</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- Iconos -->
<script src="https://unpkg.com/@phosphor-icons/web"></script>

<style>
    /* Estilos Base (Estilo Escritorio Cl칤nico) */
    body { font-family: "Segoe UI", Roboto, sans-serif; background-color: #f1f5f9; color: #334155; margin: 0; padding: 20px; }
    
    /* Hoja de Papel */
    .paper { 
        background: white; 
        max-width: 900px; 
        margin: 0 auto 80px auto; 
        padding: 50px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.05); 
        border-radius: 8px; 
        border: 1px solid #e2e8f0;
    }
    
    /* Encabezados */
    .header { text-align: center; border-bottom: 2px solid #334155; padding-bottom: 20px; margin-bottom: 30px; }
    .header h1 { font-size: 16pt; margin: 0; color: #1e293b; font-weight: 800; letter-spacing: -0.5px; }
    .header h2 { font-size: 11pt; margin: 5px 0; color: #64748b; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; }
    
    /* Secciones */
    .section-header { 
        background: #f8fafc; color: #0f172a; padding: 8px 15px; 
        font-weight: 700; margin-top: 35px; margin-bottom: 15px; 
        border-radius: 6px; text-transform: uppercase; font-size: 0.85rem; 
        border-left: 4px solid #334155; letter-spacing: 0.5px;
    }
    
    .sub-header { 
        color: #0d9488; border-bottom: 1px solid #ccfbf1; 
        padding-bottom: 4px; margin-top: 25px; margin-bottom: 12px; 
        font-weight: 700; font-size: 0.9rem;
    }

    /* Alertas de Riesgo */
    .alert-box { 
        background-color: #fef2f2; border: 1px solid #ef4444; color: #b91c1c; 
        padding: 15px; border-radius: 8px; font-weight: bold; margin: 15px 0; 
        display: none; animation: pulse 2s infinite; 
        font-size: 0.9rem; text-align: center;
    }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

    /* Grids y Formulario */
    .row { display: flex; gap: 20px; margin-bottom: 15px; flex-wrap: wrap; }
    .col { flex: 1; min-width: 200px; }
    
    label { font-weight: 600; font-size: 0.8rem; display: block; color: #64748b; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
    
    input[type="text"], input[type="number"], input[type="date"], select, textarea { 
        width: 100%; padding: 10px 12px; border: 1px solid #cbd5e1; border-radius: 6px; 
        font-size: 0.95rem; box-sizing: border-box; background: #fff; color: #334155;
        transition: all 0.2s; font-family: inherit;
    }
    input:focus, textarea:focus, select:focus { 
        border-color: #0d9488; outline: none; ring: 2px solid #ccfbf1; box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1); 
    }
    
    textarea { min-height: 80px; resize: vertical; line-height: 1.5; }

    /* Tablas */
    .styled-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
    .styled-table th { background: #f1f5f9; padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0; color: #475569; font-weight: 700; }
    .styled-table td { border-bottom: 1px solid #e2e8f0; padding: 8px; }
    .styled-table input[type="checkbox"] { width: 18px; height: 18px; accent-color: #0d9488; cursor: pointer; }

    /* Checkboxes Grid */
    .check-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 12px; margin-top: 8px; }
    .check-label { 
        display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; 
        padding: 8px; border-radius: 6px; transition: background 0.2s;
    }
    .check-label:hover { background: #f1f5f9; }
    .check-label input { width: 16px; height: 16px; accent-color: #0f172a; margin: 0; cursor: pointer; }

    /* Botones Flotantes */
    .fab-container { position: fixed; bottom: 30px; right: 30px; display: flex; flex-direction: column; gap: 12px; z-index: 100; }
    .btn-fab { 
        border: none; padding: 12px 20px; border-radius: 50px; font-weight: 600; cursor: pointer; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 10px; 
        transition: transform 0.2s, box-shadow 0.2s; font-family: "Segoe UI", sans-serif; font-size: 0.9rem;
    }
    .btn-fab:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.25); }
    .btn-save { background: #0f172a; color: white; }
    .btn-pdf { background: #be123c; color: white; }
    .btn-home { background: #fff; color: #334155; border: 1px solid #cbd5e1; }

    @media print { .fab-container { display: none; } body { background: white; padding: 0; } .paper { box-shadow: none; margin: 0; padding: 20px; border: none; } }
</style>
</head>
<body>

<div class="paper">
    <div class="header">
        <h1>CENTRO DE BACHILLERATO TECNOL칍GICO AGROPECUARIO No. 130</h1>
        <h2>ENTREVISTA CL칈NICA PSICOPEDAG칍GICA INTEGRAL</h2>
    </div>

    <!-- CONTROL -->
    <div class="row" style="background:#f8fafc; padding:15px; border-radius:8px; border: 1px solid #e2e8f0;">
        <div class="col" style="max-width: 150px;"><label>Expediente:</label><input type="text" id="expediente" style="font-family: monospace; font-weight: bold;"></div>
        <div class="col" style="max-width: 180px;"><label>Fecha:</label><input type="date" id="fecha"></div>
        <div class="col"><label>Entrevistador:</label><input type="text" id="entrevistador" value="Psic. Cecilio Topete Cruz"></div>
    </div>

    <!-- A. ENCUADRE -->
    <div class="section-header">A. FICHA DE IDENTIFICACI칍N</div>
    <div class="row">
        <div class="col" style="flex:2"><label>Nombre del Estudiante:</label><input type="text" id="nombre" placeholder="Nombre Completo"></div>
        <div class="col"><label>Edad:</label><input type="number" id="edad"></div>
        <div class="col"><label>Semestre y Grupo:</label><input type="text" id="semestre"></div>
    </div>

    <!-- B. MOTIVO -->
    <div class="section-header">B. MOTIVO DE CONSULTA</div>
    <label>Motivo manifiesto (Lo que dice el estudiante):</label>
    <textarea id="motivoConsulta" placeholder="Describa el motivo..."></textarea>
    <div style="margin-top: 15px;">
        <label>Historia del Problema (Inicio, evoluci칩n, factores desencadenantes):</label>
        <textarea id="historiaProblema" style="height:120px;"></textarea>
    </div>

    <!-- C. FAMILIA -->
    <div class="section-header">C. CONTEXTO FAMILIAR</div>
    <label>Din치mica Familiar (Estructura, comunicaci칩n, conflictos):</label>
    <textarea id="dinamiaFamiliar"></textarea>

    <!-- D. ACAD칄MICA -->
    <div class="section-header">D. HISTORIA ACAD칄MICA</div>
    <div class="row">
        <div class="col"><label>Promedio Actual:</label><input type="text" id="promedio"></div>
        <div class="col" style="flex:2"><label>Materias con Dificultad:</label><input type="text" id="matDif"></div>
    </div>
    <label>H치bitos de Estudio y Actitud escolar:</label>
    <textarea id="habitos"></textarea>

    <!-- F. EMOCIONAL -->
    <div class="section-header">E. EXPLORACI칍N EMOCIONAL</div>
    
    <div class="sub-header">Estado Emocional Actual</div>
    <div class="row">
        <div class="col"><label>Escala de 츼nimo (1-10):</label><input type="number" id="animoScale" min="1" max="10"></div>
        <div class="col">
            <label>Estado Predominante:</label>
            <select id="predominioEmocional">
                <option value="">-- Seleccione --</option>
                <option value="Tristeza">Tristeza / Melancol칤a</option>
                <option value="Ansiedad">Ansiedad / Nerviosismo</option>
                <option value="Irritabilidad">Irritabilidad / Enojo</option>
                <option value="Apat칤a">Apat칤a / Indiferencia</option>
                <option value="Eutimico">Estable / Eut칤mico</option>
                <option value="Labil">L치bil / Cambiante</option>
            </select>
        </div>
    </div>

    <label style="margin-top:15px;">Sintomatolog칤a presente (칔ltimas 2 semanas):</label>
    <div class="check-grid">
        <label class="check-label"><input type="checkbox" id="sin1"> Tristeza persistente</label>
        <label class="check-label"><input type="checkbox" id="sin2"> Llanto f치cil</label>
        <label class="check-label"><input type="checkbox" id="sin3"> Anhedonia (P칠rdida inter칠s)</label>
        <label class="check-label"><input type="checkbox" id="sin4"> Fatiga / Baja energ칤a</label>
        <label class="check-label"><input type="checkbox" id="sin5"> Alteraci칩n del sue침o</label>
        <label class="check-label"><input type="checkbox" id="sin6"> Alteraci칩n del apetito</label>
        <label class="check-label"><input type="checkbox" id="sin7"> Dif. Concentraci칩n</label>
        <label class="check-label"><input type="checkbox" id="sin8"> Culpa / Inutilidad</label>
        <label class="check-label"><input type="checkbox" id="sin9"> Crisis de ansiedad</label>
    </div>

    <!-- ALERTA DE RIESGO -->
    <div class="section-header" style="background:#fef2f2; border-color:#ef4444; color:#991b1b;">丘멆잺 PROTOCOLO DE RIESGO</div>
    <div class="row">
        <div class="col"><label>Ideaci칩n Suicida:</label><select id="ideaMuerte" onchange="checkRisk()"><option value="Negada">Negada</option><option value="Pasiva">Pasiva (Deseo muerte)</option><option value="Activa">Activa (Pensamientos)</option></select></div>
        <div class="col"><label>Planificaci칩n:</label><select id="planSuicida" onchange="checkRisk()"><option value="Sin Plan">Sin Plan</option><option value="Vago">Plan Inespec칤fico</option><option value="Estructurado">Plan Estructurado</option></select></div>
        <div class="col"><label>Autolesiones:</label><select id="autolesiones"><option value="Niega">Niega</option><option value="Hist칩rico">En el pasado</option><option value="Reciente">Reciente/Actual</option></select></div>
    </div>
    
    <div id="riskAlert" class="alert-box">
        <i class="ph-bold ph-warning-octagon"></i> ALERTA CL칈NICA ACTIVADA: Evaluar necesidad de referencia psiqui치trica urgente.
    </div>
    <label>Detalles del Riesgo y Factores Protectores:</label>
    <textarea id="detalleRiesgo" placeholder="Describir frecuencia, m칠todo, intenci칩n y redes de apoyo..." style="border-color:#fca5a5;"></textarea>

    <!-- G. CONDUCTAS DE RIESGO -->
    <div class="section-header">F. CONDUCTAS DE RIESGO</div>
    <table class="styled-table">
        <thead><tr><th style="width:30%">Sustancia</th><th style="width:10%">Uso</th><th>Frecuencia y Patr칩n de Consumo</th></tr></thead>
        <tbody>
            <tr><td>Tabaco / Vape</td><td><input type="checkbox" id="usoTabaco"></td><td><input type="text" id="frecTabaco"></td></tr>
            <tr><td>Alcohol</td><td><input type="checkbox" id="usoAlcohol"></td><td><input type="text" id="frecAlcohol"></td></tr>
            <tr><td>Marihuana</td><td><input type="checkbox" id="usoMarihuana"></td><td><input type="text" id="frecMarihuana"></td></tr>
            <tr><td>Otras drogas</td><td><input type="checkbox" id="usoOtras"></td><td><input type="text" id="frecOtras"></td></tr>
        </tbody>
    </table>

    <label style="margin-top:15px;">Otros Indicadores de Riesgo:</label>
    <div class="check-grid">
        <label class="check-label"><input type="checkbox" id="riesgoSexual"> Conducta sexual riesgo</label>
        <label class="check-label"><input type="checkbox" id="riesgoViolencia"> Violencia/Pandillerismo</label>
        <label class="check-label"><input type="checkbox" id="riesgoRedes"> Ciberadicci칩n</label>
        <label class="check-label"><input type="checkbox" id="riesgoBullying"> Acoso Escolar (V칤ctima/Agresor)</label>
        <label class="check-label"><input type="checkbox" id="riesgoAlim"> Trastorno Alimentario</label>
    </div>

    <!-- H. COGNITIVO -->
    <div class="section-header">G. EXAMEN MENTAL</div>
    <div class="row">
        <div class="col"><label>Apariencia/Ali침o:</label><input type="text" id="emApariencia"></div>
        <div class="col"><label>Lenguaje/Discurso:</label><input type="text" id="emHabla"></div>
        <div class="col"><label>Orientaci칩n (T/E/P):</label><input type="text" id="emOrientacion"></div>
    </div>
    <div class="row">
        <div class="col"><label>Curso Pensamiento:</label><input type="text" id="emPensamiento"></div>
        <div class="col"><label>Juicio/Insight:</label><input type="text" id="emJuicio"></div>
    </div>

    <!-- I. VOCACIONAL -->
    <div class="section-header">H. PROYECTO DE VIDA</div>
    <label>Intereses y Metas a Futuro:</label>
    <textarea id="metasVida" style="height:60px;"></textarea>

    <!-- M. IMPRESI칍N CL칈NICA -->
    <div class="section-header">I. FORMULACI칍N CL칈NICA</div>
    
    <label>Impresi칩n Diagn칩stica (S칤ntesis del caso):</label>
    <textarea id="impDiagnostica" style="background:#f0f9ff; border-color:#bae6fd;"></textarea>

    <div class="row" style="margin-top:10px;">
        <div class="col" style="flex:2"><label>Hip칩tesis Diagn칩stica (CIE-11 / DSM-5):</label><input type="text" id="hipotesisDiag"></div>
        <div class="col">
            <label>Nivel de Riesgo Global:</label>
            <select id="riesgoGlobal" style="font-weight:bold;">
                <option value="Bajo">游릭 Bajo</option>
                <option value="Moderado">游리 Moderado</option>
                <option value="Alto">游 Alto</option>
                <option value="Inminente">游댮 Inminente</option>
            </select>
        </div>
    </div>

    <label style="margin-top:15px;">Plan de Intervenci칩n y Acuerdos:</label>
    <textarea id="planIntervencion" placeholder="Acciones a seguir, citatorios, canalizaci칩n..." style="height:100px;"></textarea>

    <div class="row" style="margin-top:50px; gap:50px;">
        <div class="col" style="text-align:center;">
            <div style="border-bottom:1px solid #94a3b8; height:30px;"></div>
            <label style="margin-top:5px;">Firma del Entrevistador</label>
        </div>
        <div class="col" style="text-align:center;">
            <div style="border-bottom:1px solid #94a3b8; height:30px;"></div>
            <label style="margin-top:5px;">Vo.Bo. Coordinaci칩n</label>
        </div>
    </div>

</div>

<!-- BOTONES FLOTANTES -->
<div class="fab-container">
    <button class="btn-fab btn-save" onclick="guardarLocal()">
        <i class="ph-bold ph-floppy-disk text-xl"></i> Guardar
    </button>
    <button class="btn-fab btn-pdf" onclick="generarPDFCompleto()">
        <i class="ph-bold ph-file-pdf text-xl"></i> Generar PDF
    </button>
    <button class="btn-fab btn-home" onclick="location.href='index.html'">
        <i class="ph-bold ph-house text-xl"></i> Salir
    </button>
</div>

<script>
    const STORAGE_KEY = "cbta_entrevista_data";
    document.getElementById('fecha').valueAsDate = new Date();

    function checkRisk() {
        const i1 = document.getElementById('ideaMuerte').value;
        const i2 = document.getElementById('planSuicida').value;
        const alertBox = document.getElementById('riskAlert');
        
        if(i1 !== "Negada" || i2 !== "Sin Plan") {
            alertBox.style.display = "block";
        } else {
            alertBox.style.display = "none";
        }
    }

    // Auto-Guardado y Carga
    window.onload = function() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if(saved) {
            const data = JSON.parse(saved);
            const inputs = document.querySelectorAll('input, textarea, select');
            inputs.forEach(input => {
                if(input.id && data[input.id] !== undefined) {
                    if(input.type === "checkbox") input.checked = data[input.id];
                    else input.value = data[input.id];
                }
            });
            checkRisk();
        }
    };

    function guardarLocal() {
        const data = {};
        const inputs = document.querySelectorAll('input, textarea, select');
        inputs.forEach(input => {
            if(input.id) {
                if(input.type === "checkbox") data[input.id] = input.checked;
                else data[input.id] = input.value;
            }
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        
        // Feedback visual simple
        const btn = document.querySelector('.btn-save');
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="ph-bold ph-check text-xl"></i> Guardado';
        btn.style.backgroundColor = "#059669";
        setTimeout(() => {
            btn.innerHTML = original;
            btn.style.backgroundColor = "#0f172a";
        }, 2000);
    }

    function generarPDFCompleto() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let y = 20;
        
        // Helpers
        const val = (id) => document.getElementById(id).value || "---";
        const chk = (id) => document.getElementById(id).checked ? "S칈" : "NO";
        
        // Configuraci칩n
        doc.setFont("helvetica", "normal");
        
        // --- HEADER ---
        doc.setFontSize(12); doc.setFont("helvetica", "bold");
        doc.text("CENTRO DE BACHILLERATO TECNOL칍GICO AGROPECUARIO No. 130", 105, y, null, null, "center"); y+=7;
        doc.setFontSize(10);
        doc.text("ENTREVISTA CL칈NICA PSICOPEDAG칍GICA", 105, y, null, null, "center"); y+=10;
        
        doc.setFontSize(8); doc.setFont("helvetica", "normal");
        doc.text(`EXPEDIENTE: ${val('expediente')}   |   FECHA: ${val('fecha')}   |   ENTREVISTADOR: ${val('entrevistador')}`, 15, y); y+=8;

        const addSection = (title) => {
            if(y > 275) { doc.addPage(); y=20; }
            doc.setFillColor(241, 245, 249); doc.rect(12, y, 186, 6, 'F');
            doc.setFont("helvetica", "bold"); doc.setFontSize(9); doc.setTextColor(15, 23, 42);
            doc.text(title, 15, y+4); y+=10;
            doc.setFont("helvetica", "normal"); doc.setTextColor(0);
        };
        
        const addField = (lbl, txt) => {
            if(y > 275) { doc.addPage(); y=20; }
            doc.setFont("helvetica", "bold"); doc.text(lbl, 15, y);
            const lines = doc.splitTextToSize(txt, 130);
            doc.setFont("helvetica", "normal"); doc.text(lines, 65, y);
            y += (lines.length * 4) + 3;
        };

        // --- CONTENIDO ---
        addSection("A. FICHA DE IDENTIFICACI칍N");
        addField("Estudiante:", `${val('nombre')} (${val('edad')} a침os)`);
        addField("Escolar:", val('semestre'));

        addSection("B. MOTIVO Y C. FAMILIA");
        addField("Motivo:", val('motivoConsulta'));
        addField("Historia Problema:", val('historiaProblema'));
        addField("Din치mica Familiar:", val('dinamiaFamiliar'));

        addSection("D. ACAD칄MICO Y E. EMOCIONAL");
        addField("Acad칠mico:", `Prom: ${val('promedio')} | Dif: ${val('matDif')} | H치bitos: ${val('habitos')}`);
        addField("Estado Emocional:", `츼nimo: ${val('animoScale')}/10 | Predominio: ${val('predominioEmocional')}`);
        
        // S칤ntomas en una l칤nea
        let sint = [];
        if(document.getElementById('sin1').checked) sint.push("Tristeza");
        if(document.getElementById('sin2').checked) sint.push("Llanto");
        if(document.getElementById('sin4').checked) sint.push("Fatiga");
        if(document.getElementById('sin5').checked) sint.push("Sue침o");
        if(document.getElementById('sin9').checked) sint.push("Ansiedad");
        if(sint.length > 0) addField("S칤ntomas:", sint.join(", "));

        // RIESGO
        if(val('ideaMuerte') !== "Negada" || val('planSuicida') !== "Sin Plan") {
            doc.setTextColor(185, 28, 28);
            addField("ALERTA RIESGO:", `Ideaci칩n: ${val('ideaMuerte')} | Plan: ${val('planSuicida')}`);
            doc.setTextColor(0);
            if(val('detalleRiesgo')!=="---") addField("Detalle Riesgo:", val('detalleRiesgo'));
        }

        addSection("F. CONDUCTAS DE RIESGO");
        let sust = [];
        if(document.getElementById('usoTabaco').checked) sust.push(`Tabaco(${val('frecTabaco')})`);
        if(document.getElementById('usoAlcohol').checked) sust.push(`Alcohol(${val('frecAlcohol')})`);
        if(document.getElementById('usoMarihuana').checked) sust.push(`Marihuana(${val('frecMarihuana')})`);
        addField("Sustancias:", sust.join(", ") || "Niega consumo");

        addSection("G. EXAMEN MENTAL");
        addField("Observaci칩n:", `Apariencia: ${val('emApariencia')} | Lenguaje: ${val('emHabla')}`);
        addField("Procesos:", `Pensamiento: ${val('emPensamiento')} | Juicio: ${val('emJuicio')}`);

        addSection("H. IMPRESI칍N DIAGN칍STICA Y PLAN");
        addField("Impresi칩n Dx:", val('impDiagnostica'));
        addField("Hip칩tesis:", val('hipotesisDiag'));
        
        doc.setFont("helvetica", "bold");
        doc.text(`RIESGO GLOBAL: ${document.getElementById('riesgoGlobal').value}`, 15, y); y+=6;
        
        addField("Plan Intervenci칩n:", val('planIntervencion'));

        // FIRMAS
        y = Math.max(y, 250); // Empujar al final si hay espacio
        if(y > 260) { doc.addPage(); y=40; } else y+=20;
        
        doc.setLineWidth(0.5);
        doc.line(70, y, 140, y);
        doc.setFont("helvetica", "normal");
        doc.text("Firma del Entrevistador", 105, y+5, null, null, "center");

        doc.save(`Entrevista_${val('nombre').replace(/\s+/g, '_')}.pdf`);
    }
</script>
</body>
</html>

