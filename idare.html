<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluaci√≥n IDARE - CBTa 130</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background-color: #f0f2f5; color: #1c1c1e; }
    /* Encabezado AZUL OSCURO/GRIS√ÅCEO para IDARE */
    header { background: linear-gradient(135deg, #37474f 0%, #455a64 100%); color: white; text-align: center; padding: 25px; font-weight: bold; font-size: 1.4rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    h2 { color: #37474f; text-align: center; margin-top: 0; border-bottom: 2px solid #cfd8dc; padding-bottom: 10px; }
    
    .input-group { margin-bottom: 15px; }
    label { font-weight: 600; display: block; margin-bottom: 8px; color: #333; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
    
    .table-container { overflow-x: auto; margin-bottom: 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; min-width: 600px; }
    th { background-color: #eceff1; color: #37474f; padding: 10px; text-align: center; position: sticky; top: 0; }
    td { border-bottom: 1px solid #eee; padding: 12px 5px; text-align: center; }
    td:first-child { text-align: left; font-weight: 500; width: 45%; padding-left: 10px; }
    tr:nth-child(even) { background-color: #fafafa; }

    .part-title { background-color: #cfd8dc; padding: 10px; border-radius: 5px; color: #263238; font-weight: bold; margin-top: 20px; }

    .buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
    button { padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; color: white; cursor: pointer; width: 100%; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .whatsapp { background-color: #25D366; }
    .reset { background-color: #757575; }
    input[type="radio"] { transform: scale(1.5); cursor: pointer; }
    #result-area { display: none; text-align: center; margin-top: 20px; padding: 20px; background: #eceff1; border-radius: 10px; }
</style>
</head>
<body>
<header>CBTa No.130<br><span style="font-size:0.8em; font-weight:normal">Inventario de Ansiedad (IDARE)</span></header>

<div class="container">
    <div id="test-form">
        <h2>Datos del Alumno</h2>
        <div class="input-group"><label>Nombre Completo:</label><input type="text" id="nombre" required></div>
        <div class="input-group"><label>Fecha:</label><input type="date" id="fecha" required></div>
        
        <!-- PARTE 1: ESTADO -->
        <div class="part-title">PARTE 1: C√ìMO SE SIENTE AHORA MISMO</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>√çtem</th><th>Nada (1)</th><th>Poco (2)</th><th>Regular (3)</th><th>Mucho (4)</th></tr>
                </thead>
                <tbody id="tabla-estado"></tbody>
            </table>
        </div>

        <!-- PARTE 2: RASGO -->
        <div class="part-title">PARTE 2: C√ìMO SE SIENTE GENERALMENTE</div>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>√çtem</th><th>Casi Nunca (1)</th><th>A veces (2)</th><th>Frecuente (3)</th><th>Casi Siempre (4)</th></tr>
                </thead>
                <tbody id="tabla-rasgo"></tbody>
            </table>
        </div>

        <div class="buttons">
            <button type="button" class="whatsapp" onclick="finalizarTest()">‚úÖ Finalizar y Enviar</button>
        </div>
    </div>

    <div id="result-area">
        <h3 style="color:#37474f;">¬°Registro Completado!</h3>
        <p>Sus respuestas han sido procesadas.</p>
        <div class="buttons">
            <button type="button" class="whatsapp" onclick="enviarWhatsApp()">üì≤ Enviar Datos por WhatsApp</button>
            <button type="button" class="reset" onclick="location.reload()">üîÑ Nuevo Test</button>
        </div>
    </div>
</div>

<script>
    const NUMERO_DESTINO = "523111477413"; 
    
    // √çtems Estado (1-20)
    const itemsEstado = [
        "1. Me siento calmado", "2. Me siento seguro", "3. Estoy tenso", "4. Estoy contrariado",
        "5. Me siento a gusto", "6. Me siento alterado", "7. Estoy preocupado por desgracias",
        "8. Me siento descansado", "9. Me siento ansioso", "10. Me siento c√≥modo",
        "11. Me siento con confianza", "12. Me siento nervioso", "13. Estoy agitado",
        "14. Me siento a punto de explotar", "15. Me siento relajado", "16. Me siento satisfecho",
        "17. Estoy preocupado", "18. Me siento aturdido/confuso", "19. Me siento alegre", "20. Me siento bien"
    ];

    // √çtems Rasgo (21-40)
    const itemsRasgo = [
        "21. Me siento bien", "22. Me canso r√°pidamente", "23. Siento ganas de llorar", "24. Quisiera ser tan feliz como otros",
        "25. Pierdo oportunidades por no decidir", "26. Me siento descansado", "27. Soy una persona tranquila",
        "28. Dificultades se amontonan", "29. Me preocupo demasiado", "30. Soy feliz",
        "31. Tomo cosas muy a pecho", "32. Me falta confianza", "33. Me siento seguro",
        "34. Evito crisis/dificultades", "35. Me siento melanc√≥lico", "36. Me siento satisfecho",
        "37. Ideas molestas en mi mente", "38. Me afectan los desenga√±os", "39. Soy una persona estable",
        "40. Me pongo tenso pensando en asuntos"
    ];

    // Renderizar Tablas
    const tEstado = document.getElementById('tabla-estado');
    itemsEstado.forEach((t, i) => {
        let idx = i + 1;
        tEstado.innerHTML += `<tr><td>${t}</td>${[1,2,3,4].map(v=>`<td><input type="radio" name="e${idx}" value="${v}"></td>`).join('')}</tr>`;
    });

    const tRasgo = document.getElementById('tabla-rasgo');
    itemsRasgo.forEach((t, i) => {
        let idx = i + 21;
        tRasgo.innerHTML += `<tr><td>${t}</td>${[1,2,3,4].map(v=>`<td><input type="radio" name="r${idx}" value="${v}"></td>`).join('')}</tr>`;
    });

    document.getElementById('fecha').valueAsDate = new Date();
    let datosFinales = null;

    function finalizarTest() {
        const nombre = document.getElementById('nombre').value;
        const fecha = document.getElementById('fecha').value;
        if(!nombre) { alert("Nombre requerido"); return; }

        let scoreEstado = 0, scoreRasgo = 0, count = 0;
        
        // --- C√ÅLCULO ESTADO (1-20) ---
        // Inversos (Se punt√∫an 5 - x): 1, 2, 5, 8, 10, 11, 15, 16, 19, 20
        const invE = [1, 2, 5, 8, 10, 11, 15, 16, 19, 20];
        
        for(let i=1; i<=20; i++){
            const el = document.querySelector(`input[name="e${i}"]:checked`);
            if(el) {
                let v = parseInt(el.value);
                scoreEstado += invE.includes(i) ? (5 - v) : v;
                count++;
            }
        }

        // --- C√ÅLCULO RASGO (21-40) ---
        // Inversos (Se punt√∫an 5 - x): 21, 26, 27, 30, 33, 36, 39
        const invR = [21, 26, 27, 30, 33, 36, 39];
        
        for(let i=21; i<=40; i++){
            const el = document.querySelector(`input[name="r${i}"]:checked`);
            if(el) {
                let v = parseInt(el.value);
                scoreRasgo += invR.includes(i) ? (5 - v) : v;
                count++;
            }
        }

        if(count < 40) { alert(`Faltan preguntas (${count}/40)`); return; }

        datosFinales = { nombre, fecha, scoreEstado, scoreRasgo };

        document.getElementById('test-form').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        window.scrollTo(0,0);
    }

    function enviarWhatsApp(){
        if(!datosFinales) return;
        let m = `üå´Ô∏è *DATOS IDARE*%0Aüë§ ${datosFinales.nombre}%0AüìÖ ${datosFinales.fecha}%0Aüìä E (Estado): ${datosFinales.scoreEstado}%0Aüìä R (Rasgo): ${datosFinales.scoreRasgo}`;
        window.location.href = `https://wa.me/${NUMERO_DESTINO}?text=${m}`;
    }
</script>
</body>
</html>

