<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluaci√≥n IDARE - CBTa 130</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background-color: #f0f2f5; color: #1c1c1e; }
    header { background: linear-gradient(135deg, #37474f 0%, #455a64 100%); color: white; text-align: center; padding: 25px; font-weight: bold; font-size: 1.4rem; }
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    h2 { color: #37474f; text-align: center; margin-top: 0; border-bottom: 2px solid #cfd8dc; padding-bottom: 10px; }
    .input-group { margin-bottom: 15px; }
    label { font-weight: 600; display: block; margin-bottom: 8px; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    .table-container { overflow-x: auto; margin-bottom: 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; min-width: 600px; table-layout: fixed; }
    th, td { padding: 12px 5px; border-bottom: 1px solid #eee; vertical-align: middle; }
    th:first-child, td:first-child { width: 50%; text-align: left; padding-left: 10px; }
    th:not(:first-child), td:not(:first-child) { width: 12.5%; text-align: center; }
    th { background-color: #eceff1; color: #37474f; position: sticky; top: 0; font-weight: bold; }
    tr:nth-child(even) { background-color: #fafafa; }
    input[type="radio"] { width: 24px; height: 24px; margin: 0 auto; display: block; cursor: pointer; }
    .part-title { background-color: #cfd8dc; padding: 10px; border-radius: 5px; color: #263238; font-weight: bold; margin-top: 20px; }
    .buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
    button { padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; color: white; cursor: pointer; width: 100%; }
    .whatsapp { background-color: #25D366; }
    .local-save { background-color: #1565C0; }
    .reset { background-color: #757575; }
    .btn-back { background-color: #78909c; }
    #result-area { display: none; text-align: center; margin-top: 20px; padding: 20px; background: #eceff1; border-radius: 10px; }
</style>
</head>
<body>
<header>CBTa No.130<br><span style="font-size:0.8em;">Inventario de Ansiedad (IDARE)</span></header>
<div class="container">
    <div id="test-form">
        <h2>Datos del Alumno</h2>
        <div class="input-group"><label>Nombre:</label><input type="text" id="nombre" required></div>
        <div class="input-group"><label>Fecha:</label><input type="date" id="fecha" required></div>
        
        <div class="part-title">PARTE 1: ESTADO (AHORA)</div>
        <div class="table-container">
            <table><thead><tr><th>√çtem</th><th>Nada<br>(1)</th><th>Poco<br>(2)</th><th>Reg<br>(3)</th><th>Mucho<br>(4)</th></tr></thead><tbody id="tabla-estado"></tbody></table>
        </div>
        <div class="part-title">PARTE 2: RASGO (GENERALMENTE)</div>
        <div class="table-container">
            <table><thead><tr><th>√çtem</th><th>Nunca<br>(1)</th><th>A veces<br>(2)</th><th>Frec<br>(3)</th><th>Siempre<br>(4)</th></tr></thead><tbody id="tabla-rasgo"></tbody></table>
        </div>
        <div class="buttons">
            <button type="button" class="whatsapp" onclick="finalizarTest()">‚úÖ Finalizar</button>
            <button type="button" class="btn-back" onclick="window.location.href='index.html'">‚Ü©Ô∏è Cancelar y Volver</button>
        </div>
    </div>
    <div id="result-area">
        <h3 style="color:#37474f;">Resultados Listos</h3>
        <div class="buttons">
            <button type="button" class="local-save" onclick="guardarLocalmente()">üíæ Guardar en Expediente</button>
            <button type="button" class="whatsapp" onclick="enviarWhatsApp()">üì≤ Enviar WhatsApp</button>
            <button type="button" class="reset" onclick="location.reload()">üîÑ Nuevo</button>
            <button type="button" class="btn-back" onclick="window.location.href='index.html'">üè† Ir al Men√∫</button>
        </div>
    </div>
</div>
<script>
    const NUMERO_DESTINO = "523111477413"; const STORAGE_KEY = "cbta_paciente_temp";
    const itemsE = ["1. Calmado", "2. Seguro", "3. Tenso", "4. Contrariado", "5. A gusto", "6. Alterado", "7. Preocupado desgracias", "8. Descansado", "9. Ansioso", "10. C√≥modo", "11. Confianza", "12. Nervioso", "13. Agitado", "14. Explotar", "15. Relajado", "16. Satisfecho", "17. Preocupado", "18. Aturdido", "19. Alegre", "20. Bien"];
    const itemsR = ["21. Bien", "22. Canso r√°pido", "23. Llorar", "24. Feliz como otros", "25. Pierdo oportunidades", "26. Descansado", "27. Tranquilo", "28. Dificultades", "29. Preocupo nimiedades", "30. Feliz", "31. A pecho", "32. Falta confianza", "33. Seguro", "34. Evito crisis", "35. Melanc√≥lico", "36. Satisfecho", "37. Ideas molestas", "38. Desenga√±os", "39. Estable", "40. Tenso asuntos"];
    
    const tE = document.getElementById('tabla-estado'); itemsE.forEach((t, i) => { tE.innerHTML += `<tr><td>${t}</td>${[1,2,3,4].map(v=>`<td><input type="radio" name="e${i+1}" value="${v}"></td>`).join('')}</tr>`; });
    const tR = document.getElementById('tabla-rasgo'); itemsR.forEach((t, i) => { tR.innerHTML += `<tr><td>${t}</td>${[1,2,3,4].map(v=>`<td><input type="radio" name="r${i+21}" value="${v}"></td>`).join('')}</tr>`; });
    document.getElementById('fecha').valueAsDate = new Date();
    let datosFinales = null;

    function finalizarTest() {
        const nombre = document.getElementById('nombre').value; const fecha = document.getElementById('fecha').value;
        if(!nombre) { alert("Nombre requerido"); return; }
        let sE = 0, sR = 0, c = 0;
        const invE = [1, 2, 5, 8, 10, 11, 15, 16, 19, 20];
        for(let i=1; i<=20; i++){ const el = document.querySelector(`input[name="e${i}"]:checked`); if(el) { let v = parseInt(el.value); sE += invE.includes(i) ? (5-v) : v; c++; } }
        const invR = [21, 26, 27, 30, 33, 36, 39];
        for(let i=21; i<=40; i++){ const el = document.querySelector(`input[name="r${i}"]:checked`); if(el) { let v = parseInt(el.value); sR += invR.includes(i) ? (5-v) : v; c++; } }
        if(c < 40) { alert(`Faltan preguntas (${c}/40)`); return; }
        datosFinales = { nombre, fecha, scoreEstado: sE, scoreRasgo: sR };
        document.getElementById('test-form').style.display = 'none'; document.getElementById('result-area').style.display = 'block'; window.scrollTo(0,0);
    }
    function guardarLocalmente() { if(!datosFinales) return; let cur = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; let up = { ...cur, nombre: datosFinales.nombre, idareE: datosFinales.scoreEstado, idareR: datosFinales.scoreRasgo }; localStorage.setItem(STORAGE_KEY, JSON.stringify(up)); alert("‚úÖ IDARE guardado."); }
    function enviarWhatsApp(){ if(!datosFinales) return; let m = `üå´Ô∏è *IDARE*%0Aüë§ ${datosFinales.nombre}%0Aüìä E: ${datosFinales.scoreEstado} | R: ${datosFinales.scoreRasgo}`; window.open(`https://wa.me/${NUMERO_DESTINO}?text=${m}`, '_blank'); }
</script>
</body>
</html>


