<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EvaluaciÃ³n BHS - CBTa 130</title>
<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background-color: #f0f2f5; color: #1c1c1e; }
    header { background: linear-gradient(135deg, #212121 0%, #424242 100%); color: white; text-align: center; padding: 25px; font-weight: bold; font-size: 1.4rem; }
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    h2 { color: #212121; text-align: center; border-bottom: 2px solid #bdbdbd; padding-bottom: 10px; }
    .input-group { margin-bottom: 15px; }
    label { font-weight: 600; display: block; margin-bottom: 8px; }
    input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
    
    /* REJILLA PARA V/F */
    .question-item { border-bottom: 1px solid #eee; padding: 15px 0; display: grid; grid-template-columns: 1fr 100px; gap: 15px; align-items: center; }
    .q-text { font-weight: 500; color: #333; font-size: 0.95rem; }
    .q-opts { display: flex; justify-content: space-between; }
    .opt-label { cursor: pointer; display: flex; flex-direction: column; align-items: center; font-weight: bold; }
    .opt-v { color: #2E7d32; } .opt-f { color: #c62828; }
    input[type="radio"] { width: 24px; height: 24px; border: 2px solid #ccc; border-radius: 50%; margin-top: 5px; cursor: pointer; }
    input[type="radio"]:checked { border-color: currentColor; background-color: currentColor; box-shadow: inset 0 0 0 4px white; }

    .buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
    button { padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; color: white; cursor: pointer; width: 100%; }
    .whatsapp { background-color: #25D366; }
    .local-save { background-color: #1565C0; }
    .reset { background-color: #757575; }
    #result-area { display: none; text-align: center; margin-top: 20px; padding: 20px; background: #f5f5f5; border-radius: 10px; }
</style>
</head>
<body>
<header>CBTa No.130<br><span style="font-size:0.8em;">Escala de Desesperanza (BHS)</span></header>
<div class="container">
    <div id="test-form">
        <h2>Datos del Alumno</h2>
        <div class="input-group"><label>Nombre:</label><input type="text" id="nombre" required></div>
        <div class="input-group"><label>Fecha:</label><input type="date" id="fecha" required></div>
        <div style="background-color:#eee; padding:15px; border-radius:8px; margin:20px 0; font-size:0.9em; border-left:5px solid #212121;">
            <strong>Instrucciones:</strong> Marque si es <strong>VERDADERA (V)</strong> o <strong>FALSA (F)</strong>.
        </div>
        <div id="questions-list"></div>
        <div class="buttons"><button type="button" class="whatsapp" onclick="finalizarTest()">âœ… Finalizar</button></div>
    </div>
    <div id="result-area">
        <h3 style="color:#212121;">Resultados Listos</h3>
        <div class="buttons">
            <button type="button" class="local-save" onclick="guardarLocalmente()">ðŸ’¾ Guardar en Expediente</button>
            <button type="button" class="whatsapp" onclick="enviarWhatsApp()">ðŸ“² Enviar WhatsApp</button>
            <button type="button" class="reset" onclick="location.reload()">ðŸ”„ Nuevo</button>
        </div>
    </div>
</div>
<script>
    const NUMERO_DESTINO = "523111477413"; 
    const STORAGE_KEY = "cbta_paciente_temp";

    const items = [
        "1. Veo el futuro con esperanza y entusiasmo", "2. QuizÃ¡ deberÃ­a abandonar todo", "3. Cuando las cosas estÃ¡n mal, me ayuda pensar que no serÃ¡ asÃ­",
        "4. No imagino mi vida en 10 aÃ±os", "5. Tengo tiempo suficiente", "6. Espero tener Ã©xito", "7. Mi futuro parece oscuro",
        "8. Espero que me sucedan cosas buenas", "9. No tengo suerte", "10. Mis experiencias me prepararon bien",
        "11. Veo todo desagradable adelante", "12. No espero conseguir lo que quiero", "13. Espero ser mÃ¡s feliz", "14. Las cosas nunca marcharÃ¡n bien",
        "15. Tengo fe en el futuro", "16. Es absurdo querer algo", "17. Improbable lograr satisfacciÃ³n", "18. Futuro vago e incierto",
        "19. Espero Ã©pocas buenas", "20. Es inÃºtil tratar de conseguir algo"
    ];
    const container = document.getElementById('questions-list');
    items.forEach((txt, i) => {
        let idx = i + 1;
        container.innerHTML += `<div class="question-item"><div class="q-text">${txt}</div><div class="q-opts"><label class="opt-label opt-v"><span>V</span><input type="radio" name="bhs${idx}" value="V"></label><label class="opt-label opt-f"><span>F</span><input type="radio" name="bhs${idx}" value="F"></label></div></div>`;
    });
    document.getElementById('fecha').valueAsDate = new Date();
    let datosFinales = null;

    function finalizarTest() {
        const nombre = document.getElementById('nombre').value;
        const fecha = document.getElementById('fecha').value;
        if(!nombre) { alert("Nombre requerido"); return; }
        let total = 0, count = 0;
        const keyTrue = [2, 4, 7, 9, 11, 12, 14, 16, 17, 18, 20];
        for(let i=1; i<=20; i++){
            const el = document.querySelector(`input[name="bhs${i}"]:checked`);
            if(el) {
                let v = el.value;
                if (keyTrue.includes(i)) { if(v === "V") total++; } else { if(v === "F") total++; }
                count++;
            }
        }
        if(count < 20) { alert("Faltan preguntas"); return; }
        datosFinales = { nombre, fecha, total };
        document.getElementById('test-form').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        window.scrollTo(0,0);
    }

    function guardarLocalmente() {
        if(!datosFinales) return;
        let current = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        let update = { ...current, nombre: datosFinales.nombre, bhs: datosFinales.total }; // Guarda en 'bhs'
        localStorage.setItem(STORAGE_KEY, JSON.stringify(update));
        alert("âœ… Datos BHS guardados.");
    }

    function enviarWhatsApp(){
        if(!datosFinales) return;
        let m = `âš« *BHS*%0AðŸ‘¤ ${datosFinales.nombre}%0AðŸ“Š Score: ${datosFinales.total}`;
        window.location.href = `https://wa.me/${NUMERO_DESTINO}?text=${m}`;
    }
</script>
</body>
</html>


