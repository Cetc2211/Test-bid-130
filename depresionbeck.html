<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluaci√≥n BDI-II - CBTa 130</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; background-color: #f0f2f5; color: #1c1c1e; }
    header { background-color: #1565C0; color: white; text-align: center; padding: 20px; font-weight: bold; font-size: 1.3rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    
    h2 { color: #1565C0; text-align: center; margin-top: 0; }
    
    .input-group { margin-bottom: 15px; }
    label { font-weight: 600; display: block; margin-bottom: 8px; color: #333; }
    input[type="text"], input[type="number"], input[type="date"] { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; font-size: 16px; box-sizing: border-box; }

    .instructions { background-color: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 0.95em; line-height: 1.5; border-left: 5px solid #1565C0; }

    .question-card { background: #fff; border: 1px solid #e0e0e0; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
    .question-title { font-weight: bold; font-size: 1.1em; margin-bottom: 10px; color: #000; }
    
    .option-label { display: flex; align-items: flex-start; padding: 10px; cursor: pointer; border-radius: 6px; transition: background 0.2s; }
    .option-label:hover { background-color: #f5f5f5; }
    .option-label input { margin-right: 12px; margin-top: 4px; transform: scale(1.3); flex-shrink: 0; }
    .option-text { font-size: 0.95em; }

    .buttons { display: flex; flex-direction: column; gap: 15px; margin-top: 30px; }
    button { padding: 16px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; color: white; cursor: pointer; width: 100%; transition: opacity 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    button:active { transform: scale(0.98); }
    
    .whatsapp { background-color: #25D366; }
    .pdf { background-color: #D32F2F; }
    .reset { background-color: #757575; }

    /* Estilo para items cr√≠ticos en el reporte (invisible al usuario) */
    .alert-box { display: none; }
</style>
</head>
<body>

<header>CBTa No.130<br><span style="font-size:0.8em; font-weight:normal">Inventario de Depresi√≥n de Beck (BDI-II)</span></header>

<div class="container">
    <h2>Datos del Paciente</h2>
    
    <div class="input-group">
        <label>Nombre Completo:</label>
        <input type="text" id="nombre" placeholder="Nombre del paciente" required>
    </div>
    
    <div class="input-group">
        <label>Edad (Importante para evaluaci√≥n):</label>
        <input type="number" id="edad" placeholder="A√±os cumplidos" required>
    </div>

    <div class="input-group">
        <label>Fecha:</label>
        <input type="date" id="fecha" required>
    </div>

    <div class="instructions">
        <strong>Instrucciones:</strong> Lea con atenci√≥n cada grupo de afirmaciones y elija la que mejor describa c√≥mo se ha sentido durante las <strong>√∫ltimas dos semanas, incluyendo el d√≠a de hoy</strong>.
    </div>

    <form id="bdiForm">
        <div id="cuestionario"></div>
    </form>

    <div class="buttons">
        <button type="button" class="whatsapp" onclick="enviarWhatsApp()">üì≤ Enviar Resultados al Doctor</button>
        <button type="button" class="pdf" onclick="generarPDF()">üìÑ Generar PDF</button>
        <button type="button" class="reset" onclick="limpiar()">üîÑ Limpiar Formulario</button>
    </div>
</div>

<script>
    // --- CONFIGURACI√ìN ---
    // Tu n√∫mero de WhatsApp (M√©xico)
    const NUMERO_DESTINO = "523111477413"; 
    // ---------------------

    // Base de datos de las preguntas exactas del BDI-II
    const items = [
        { t: "1. Tristeza", o: ["No me siento triste", "Me siento triste gran parte del tiempo", "Estoy triste todo el tiempo", "Estoy tan triste o infeliz que no puedo soportarlo"] },
        { t: "2. Pesimismo", o: ["No estoy desalentado respecto a mi futuro", "Me siento m√°s desalentado respecto a mi futuro que antes", "No espero que las cosas funcionen para m√≠", "Siento que mi futuro es desesperanzador y que s√≥lo empeorar√°"] },
        { t: "3. Fracaso", o: ["No me siento como un fracasado", "He fracasado m√°s de lo que deber√≠a", "Cuando miro hacia atr√°s veo muchos fracasos", "Siento que como persona soy un fracaso total"] },
        { t: "4. P√©rdida de Placer", o: ["Obtengo tanto placer como siempre de las cosas que disfruto", "No disfruto de las cosas tanto como antes", "Obtengo muy poco placer de las cosas que sol√≠a disfrutar", "No obtengo ning√∫n placer de las cosas que sol√≠a disfrutar"] },
        { t: "5. Sentimientos de Culpa", o: ["No me siento particularmente culpable", "Me siento culpable respecto a muchas cosas que he hecho o deber√≠a haber hecho", "Me siento bastante culpable la mayor parte del tiempo", "Me siento culpable todo el tiempo"] },
        { t: "6. Sentimientos de Castigo", o: ["No siento que est√© siendo castigado", "Siento que podr√≠a ser castigado", "Espero ser castigado", "Siento que estoy siendo castigado"] },
        { t: "7. Disconformidad con uno mismo", o: ["Me siento igual respecto a m√≠ mismo que siempre", "He perdido confianza en m√≠ mismo", "Estoy decepcionado de m√≠ mismo", "No me gusto a m√≠ mismo"] },
        { t: "8. Autocr√≠tica", o: ["No me critico o culpo m√°s de lo habitual", "Soy m√°s cr√≠tico conmigo mismo de lo que sol√≠a ser", "Me critico por todos mis errores", "Me culpo por todo lo malo que sucede"] },
        { t: "9. Pensamientos o Deseos Suicidas", o: ["No tengo ning√∫n pensamiento de suicidio", "Tengo pensamientos de suicidio, pero no los llevar√≠a a cabo", "Me gustar√≠a suicidarme", "Me suicidar√≠a si tuviera la oportunidad"] },
        { t: "10. Llanto", o: ["No lloro m√°s de lo habitual", "Lloro m√°s de lo que sol√≠a hacerlo", "Lloro por cualquier peque√±ez", "Siento ganas de llorar pero no puedo"] },
        { t: "11. Agitaci√≥n", o: ["No estoy m√°s inquieto o nervioso que lo habitual", "Me siento m√°s inquieto o nervioso que lo habitual", "Estoy tan inquieto que me es dif√≠cil quedarme quieto", "Estoy tan inquieto que tengo que estar movi√©ndome o haciendo algo"] },
        { t: "12. P√©rdida de Inter√©s", o: ["No he perdido inter√©s en otras personas o actividades", "Estoy menos interesado en otras personas o cosas que antes", "He perdido casi todo el inter√©s en otras personas o cosas", "Me es dif√≠cil interesarme en algo"] },
        { t: "13. Indecisi√≥n", o: ["Tomo decisiones tan bien como siempre", "Me resulta m√°s dif√≠cil tomar decisiones que lo habitual", "Tengo mucha m√°s dificultad para tomar decisiones que lo habitual", "Tengo problemas para tomar cualquier decisi√≥n"] },
        { t: "14. Desvalorizaci√≥n", o: ["No siento que sea in√∫til", "No me considero tan valioso y √∫til como sol√≠a ser", "Me siento m√°s in√∫til comparado con otras personas", "Me siento completamente in√∫til"] },
        { t: "15. P√©rdida de Energ√≠a", o: ["Tengo tanta energ√≠a como siempre", "Tengo menos energ√≠a de la que sol√≠a tener", "No tengo suficiente energ√≠a para hacer muchas cosas", "No tengo energ√≠a para hacer nada"] },
        // Items especiales con a/b
        { t: "16. Cambios en el Patr√≥n de Sue√±o", special: true, o: [
            {v:0, t:"No he experimentado ning√∫n cambio en mi patr√≥n de sue√±o"},
            {v:1, t:"1a. Duermo algo m√°s de lo habitual"},
            {v:1, t:"1b. Duermo algo menos de lo habitual"},
            {v:2, t:"2a. Duermo mucho m√°s de lo habitual"},
            {v:2, t:"2b. Duermo mucho menos de lo habitual"},
            {v:3, t:"3a. Duermo la mayor parte del d√≠a"},
            {v:3, t:"3b. Me despierto 1-2 horas m√°s temprano y no puedo volver a dormir"}
        ]},
        { t: "17. Irritabilidad", o: ["No estoy m√°s irritable que lo habitual", "Estoy m√°s irritable que lo habitual", "Estoy mucho m√°s irritable que lo habitual", "Estoy irritable todo el tiempo"] },
        { t: "18. Cambios en el Apetito", special: true, o: [
            {v:0, t:"No he experimentado ning√∫n cambio en mi apetito"},
            {v:1, t:"1a. Mi apetito es algo menor de lo habitual"},
            {v:1, t:"1b. Mi apetito es algo mayor de lo habitual"},
            {v:2, t:"2a. Mi apetito es mucho menor que antes"},
            {v:2, t:"2b. Mi apetito es mucho mayor que antes"},
            {v:3, t:"3a. No tengo apetito en absoluto"},
            {v:3, t:"3b. Tengo ganas de comer todo el tiempo"}
        ]},
        { t: "19. Dificultad de Concentraci√≥n", o: ["Puedo concentrarme tan bien como siempre", "No puedo concentrarme tan bien como antes", "Me es dif√≠cil concentrarme en algo por mucho tiempo", "No puedo concentrarme en nada"] },
        { t: "20. Cansancio o Fatiga", o: ["No estoy m√°s cansado o fatigado que lo habitual", "Me canso o fatigo m√°s f√°cilmente que lo habitual", "Estoy demasiado cansado o fatigado para hacer muchas cosas que sol√≠a hacer", "Estoy demasiado cansado o fatigado para hacer la mayor√≠a de las cosas que sol√≠a hacer"] },
        { t: "21. P√©rdida de Inter√©s en el Sexo", o: ["No he notado ning√∫n cambio reciente en mi inter√©s por el sexo", "Estoy menos interesado en el sexo de lo que sol√≠a estar", "Estoy mucho menos interesado en el sexo ahora", "He perdido completamente el inter√©s en el sexo"] }
    ];

    // Renderizar Cuestionario
    const divCuestionario = document.getElementById('cuestionario');
    items.forEach((item, index) => {
        const num = index + 1;
        let html = `<div class="question-card"><div class="question-title">${item.t}</div>`;
        
        if(item.special) {
            // Renderizado especial para items 16 y 18
            item.o.forEach(op => {
                html += `<label class="option-label">
                            <input type="radio" name="item${num}" value="${op.v}" required>
                            <span class="option-text">${op.t}</span>
                         </label>`;
            });
        } else {
            // Renderizado est√°ndar 0-3
            item.o.forEach((txt, val) => {
                html += `<label class="option-label">
                            <input type="radio" name="item${num}" value="${val}" required>
                            <span class="option-text">${val} - ${txt}</span>
                         </label>`;
            });
        }
        html += `</div>`;
        divCuestionario.innerHTML += html;
    });

    // Poner fecha hoy
    document.getElementById('fecha').valueAsDate = new Date();

    function obtenerResultados() {
        const nombre = document.getElementById('nombre').value.trim();
        const edad = parseInt(document.getElementById('edad').value);
        const fecha = document.getElementById('fecha').value;

        if (!nombre || !edad) { alert("Por favor complete nombre y edad."); return null; }

        let total = 0;
        let factorCognitivo = 0; // Items 1-14
        let factorSomatico = 0;  // Items 15-21
        let contestadas = 0;
        let alertas = [];

        for (let i = 1; i <= 21; i++) {
            const el = document.querySelector(`input[name="item${i}"]:checked`);
            if (el) {
                const val = parseInt(el.value);
                total += val;
                contestadas++;

                // Factores
                if (i <= 14) factorCognitivo += val;
                else factorSomatico += val;

                // Alertas Cr√≠ticas
                if (i === 9 && val >= 2) alertas.push("‚ö†Ô∏è RIESGO SUICIDA (√çtem 9 elevado)");
                if (i === 2 && val === 3) alertas.push("‚ö†Ô∏è DESESPERANZA SEVERA (√çtem 2 elevado)");
            }
        }

        if (contestadas < 21) { alert(`Faltan preguntas. Respondidas: ${contestadas}/21`); return null; }

        // Interpretaci√≥n seg√∫n edad (Adolescentes 15-19 vs Adultos)
        let interpretacion = "";
        const esAdolescente = (edad >= 15 && edad <= 19);
        const tipoPoblacion = esAdolescente ? "Adolescente (Mex)" : "Adulto General (Mex)";

        if (esAdolescente) {
            if (total <= 12) interpretacion = "Sin depresi√≥n";
            else if (total <= 18) interpretacion = "Depresi√≥n LEVE";
            else if (total <= 27) interpretacion = "Depresi√≥n MODERADA";
            else interpretacion = "Depresi√≥n SEVERA";
        } else {
            if (total <= 13) interpretacion = "M√≠nima / Sin depresi√≥n";
            else if (total <= 19) interpretacion = "Depresi√≥n LEVE";
            else if (total <= 28) interpretacion = "Depresi√≥n MODERADA";
            else interpretacion = "Depresi√≥n SEVERA";
        }

        if (total >= 29) alertas.push("‚ö†Ô∏è SE RECOMIENDA EVALUACI√ìN PSIQUI√ÅTRICA");

        return { nombre, edad, fecha, total, interpretacion, factorCognitivo, factorSomatico, alertas, tipoPoblacion };
    }

    function enviarWhatsApp() {
        const r = obtenerResultados();
        if (!r) return;

        let mensaje = `üìã *RESULTADOS BDI-II (Depresi√≥n)*%0A` +
                      `üë§ Paciente: ${r.nombre} (${r.edad} a√±os)%0A` +
                      `üìÖ Fecha: ${r.fecha}%0A` +
                      `-----------------------------%0A` +
                      `üìä *PUNTAJE TOTAL: ${r.total}*%0A` +
                      `üè∑Ô∏è *Nivel:* ${r.interpretacion}%0A` +
                      `‚ÑπÔ∏è Baremo: ${r.tipoPoblacion}%0A` +
                      `-----------------------------%0A` +
                      `üß† Factor Cognitivo: ${r.factorCognitivo}%0A` +
                      `‚ù§Ô∏è Factor Som√°tico: ${r.factorSomatico}%0A`;
        
        if (r.alertas.length > 0) {
            mensaje += `%0Aüö® *ALERTAS CL√çNICAS:*%0A` + r.alertas.join('%0A');
        }

        window.location.href = `https://wa.me/${NUMERO_DESTINO}?text=${mensaje}`;
    }

    function generarPDF() {
        const r = obtenerResultados();
        if (!r) return;
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Encabezado
        doc.setFillColor(21, 101, 192); // Azul
        doc.rect(0, 0, 210, 35, 'F');
        doc.setTextColor(255, 255, 255);
        doc.setFontSize(16);
        doc.text("CBTa No.130 - Informe Cl√≠nico", 105, 15, null, null, "center");
        doc.setFontSize(12);
        doc.text("Inventario de Depresi√≥n de Beck (BDI-II)", 105, 25, null, null, "center");

        // Datos
        doc.setTextColor(0,0,0);
        doc.setFontSize(11);
        doc.text(`Paciente: ${r.nombre}`, 20, 50);
        doc.text(`Edad: ${r.edad} a√±os`, 120, 50);
        doc.text(`Fecha: ${r.fecha}`, 20, 60);
        doc.text(`Baremo aplicado: ${r.tipoPoblacion}`, 120, 60);

        // L√≠nea separadora
        doc.setLineWidth(0.5);
        doc.line(20, 65, 190, 65);

        // Resultados
        doc.setFontSize(14);
        doc.setFont(undefined, 'bold');
        doc.text(`Puntuaci√≥n Total: ${r.total}`, 20, 80);
        doc.setTextColor(r.total >= 29 ? 200 : 0, 0, 0); // Rojo si es severo
        doc.text(`Interpretaci√≥n: ${r.interpretacion}`, 20, 90);
        
        // Factores
        doc.setTextColor(0,0,0);
        doc.setFontSize(11);
        doc.setFont(undefined, 'normal');
        doc.text(`‚Ä¢ Factor Cognitivo-Afectivo: ${r.factorCognitivo} / 42`, 20, 105);
        doc.text(`‚Ä¢ Factor Som√°tico-Motivacional: ${r.factorSomatico} / 21`, 20, 115);

        // Alertas
        if(r.alertas.length > 0) {
            doc.setTextColor(255, 0, 0);
            doc.setFont(undefined, 'bold');
            doc.text("ALERTAS CL√çNICAS DETECTADAS:", 20, 130);
            r.alertas.forEach((alert, i) => {
                doc.text(`‚Ä¢ ${alert.replace("‚ö†Ô∏è ", "")}`, 20, 140 + (i*10));
            });
        }

        doc.save(`BDI_${r.nombre}.pdf`);
    }

    function limpiar() {
        if(confirm("¬øBorrar respuestas?")) location.reload();
    }
</script>
</body>
</html>
