<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPA - Evaluaci√≥n Cognitiva</title>
    
    <!-- Tailwind CSS (CDN para funcionamiento sin instalaci√≥n) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Iconos Phosphor -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- Configuraci√≥n de Fuentes y Colores Institucionales -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#fce4ec',   // Fondo suave
                            100: '#f8bbd0',
                            600: '#d81b60',  // Acento brillante
                            800: '#ad1457',  // Institucional primario
                            900: '#880e4f',  // Institucional oscuro
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos base para scroll suave y fondo */
        body { 
            background-color: #f3f4f6; 
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 24px 24px;
        }
        
        /* Animaciones suaves */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilos para impresi√≥n */
        @media print {
            .no-print { display: none !important; }
            body { background: white; }
            .shadow-lg { box-shadow: none !important; }
        }
    </style>
</head>
<body class="text-slate-800 antialiased min-h-screen pb-10">

    <!-- ENCABEZADO FIJO -->
    <header class="bg-gradient-to-r from-brand-900 to-brand-800 text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-white/10 p-2 rounded-lg backdrop-blur-sm">
                    <i class="ph-bold ph-brain text-xl"></i>
                </div>
                <div>
                    <h1 class="font-bold text-lg leading-tight">Test IPA</h1>
                    <p class="text-xs text-brand-100 opacity-90">Inventario de Pensamientos</p>
                </div>
            </div>
            <!-- Bot√≥n discreto para reiniciar si se necesita -->
            <button onclick="if(confirm('¬øReiniciar test?')) location.reload()" class="text-white/80 hover:text-white transition-colors">
                <i class="ph ph-arrow-counter-clockwise text-xl"></i>
            </button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-6 space-y-6">

        <!-- ============================================== -->
        <!-- 1. SECCI√ìN DE DATOS DE IDENTIFICACI√ìN          -->
        <!-- ============================================== -->
        <section id="section-identity" class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="bg-slate-50 border-b border-slate-200 px-6 py-4">
                <h2 class="font-bold text-slate-700 flex items-center gap-2">
                    <i class="ph-duotone ph-user-circle text-brand-800 text-xl"></i>
                    Datos del Evaluado
                </h2>
            </div>
            
            <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-5">
                <!-- Nombre -->
                <div class="col-span-1 md:col-span-2">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nombre Completo</label>
                    <div class="relative">
                        <i class="ph ph-user absolute left-3 top-3 text-slate-400"></i>
                        <input type="text" id="nombre" class="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-600 outline-none transition-all font-semibold text-slate-700 placeholder-slate-400" placeholder="Ej. Juan P√©rez L√≥pez">
                    </div>
                </div>

                <!-- Grupo -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Grupo / Semestre</label>
                    <div class="relative">
                        <i class="ph ph-users-three absolute left-3 top-3 text-slate-400"></i>
                        <input type="text" id="grupo" class="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-600 outline-none transition-all" placeholder="Ej. 6¬∞ A Programaci√≥n">
                    </div>
                </div>

                <!-- Fecha -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Fecha de Aplicaci√≥n</label>
                    <div class="relative">
                        <i class="ph ph-calendar-blank absolute left-3 top-3 text-slate-400"></i>
                        <input type="date" id="fecha" class="w-full pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-lg focus:ring-2 focus:ring-brand-600 outline-none transition-all">
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================== -->
        <!-- 2. INSTRUCCIONES Y CUESTIONARIO                -->
        <!-- ============================================== -->
        <section id="section-test" class="space-y-6">
            
            <!-- Instrucciones -->
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg flex gap-3 text-sm text-blue-800 shadow-sm">
                <i class="ph-fill ph-info text-xl flex-shrink-0 mt-0.5"></i>
                <p>
                    <strong>Instrucciones:</strong> Lea cada afirmaci√≥n y seleccione la opci√≥n que mejor describa con qu√© frecuencia tiene estos pensamientos. 
                    <span class="block mt-1 text-xs opacity-80">(0 = Nunca, 1 = A veces, 2 = Bastantes veces, 3 = Con mucha frecuencia)</span>
                </p>
            </div>

            <!-- Tabla de Preguntas -->
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-brand-900 uppercase bg-brand-50 border-b border-brand-100">
                            <tr>
                                <th class="px-4 py-4 w-3/5 font-bold">Pensamiento / Situaci√≥n</th>
                                <th class="px-1 py-4 text-center w-[10%]">0</th>
                                <th class="px-1 py-4 text-center w-[10%]">1</th>
                                <th class="px-1 py-4 text-center w-[10%]">2</th>
                                <th class="px-1 py-4 text-center w-[10%]">3</th>
                            </tr>
                        </thead>
                        <tbody id="questions-body" class="divide-y divide-slate-100">
                            <!-- JS insertar√° las filas aqu√≠ -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Bot√≥n de Acci√≥n -->
            <div class="sticky bottom-4 z-40 bg-white/80 backdrop-blur p-2 rounded-2xl shadow-xl border border-slate-200">
                <button onclick="calcularResultados()" class="w-full bg-brand-800 hover:bg-brand-900 text-white font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95 flex items-center justify-center gap-2 text-lg">
                    <i class="ph-bold ph-check-circle"></i>
                    Finalizar y Ver Resultados
                </button>
            </div>
        </section>

        <!-- ============================================== -->
        <!-- 3. RESULTADOS (Oculto inicialmente)            -->
        <!-- ============================================== -->
        <section id="section-results" class="hidden space-y-6 fade-in pt-4">
            
            <!-- Tarjeta de Resumen -->
            <div class="bg-white rounded-2xl shadow-lg border-t-8 border-brand-800 overflow-hidden">
                <div class="p-8 text-center">
                    <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-green-100 text-green-600 mb-4 shadow-inner">
                        <i class="ph-fill ph-check text-3xl"></i>
                    </div>
                    
                    <h2 class="text-2xl font-bold text-slate-800 mb-1">Evaluaci√≥n Completada</h2>
                    <p id="res-nombre" class="text-lg text-brand-800 font-medium mb-6">Alumno: --</p>
                    
                    <div class="flex justify-center items-end gap-2 mb-2">
                        <span class="text-6xl font-black text-slate-800 tracking-tighter" id="res-score">0</span>
                        <span class="text-lg text-slate-400 font-medium mb-2">/ 135 pts</span>
                    </div>
                    
                    <div id="res-badge" class="inline-block px-6 py-2 rounded-full text-sm font-bold tracking-wide bg-gray-200 text-gray-600 mb-6">
                        CALCULANDO...
                    </div>

                    <p class="text-slate-500 text-sm max-w-md mx-auto">
                        A continuaci√≥n se presenta el desglose de las distorsiones cognitivas detectadas. 
                        Los niveles "Alto" indican √°reas de oportunidad prioritarias.
                    </p>
                </div>
                
                <!-- Bot√≥n Principal: WhatsApp -->
                <div class="bg-slate-50 p-4 border-t border-slate-100 flex flex-col sm:flex-row gap-3 justify-center">
                    <button onclick="enviarWhatsApp()" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-xl shadow-md flex items-center justify-center gap-2 transition-colors">
                        <i class="ph-bold ph-whatsapp-logo text-xl"></i>
                        Enviar Resultados al Evaluador
                    </button>
                    <button onclick="window.print()" class="sm:w-auto bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 font-semibold py-3 px-6 rounded-xl flex items-center justify-center gap-2 transition-colors">
                        <i class="ph-bold ph-printer text-xl"></i>
                        Imprimir
                    </button>
                </div>
            </div>

            <!-- Desglose de Factores -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="factors-grid">
                <!-- Se llena con JS -->
            </div>

        </section>

    </main>

    <script>
        // === CONFIGURACI√ìN ===
        const NUMERO_EVALUADOR = "523111477413"; // N√∫mero destino predeterminado
        
        const preguntas = [
            "1. No puedo soportar ciertas cosas que me pasan.",
            "2. Solamente me pasan cosas malas.",
            "3. Todo lo que hago me sale mal.",
            "4. S√© que piensan mal de m√≠.",
            "5. ¬øY si tengo alguna enfermedad grave?.",
            "6. Soy inferior a la gente en casi todo.",
            "7. Si otros cambiaran su actitud yo me sentir√≠a mejor.",
            "8. ¬°No hay derecho a que me traten as√≠!.",
            "9. Si me siento triste es porque soy un enfermo mental.",
            "10. Mis problemas dependen de los que me rodean.",
            "11. Soy un desastre como persona.",
            "12. Yo tengo la culpa de todo lo que me pasa.",
            "13. Deber√≠a de estar bien y no tener estos problemas.",
            "14. S√© que tengo la raz√≥n y no me entienden.",
            "15. Aunque ahora sufra, alg√∫n d√≠a tendr√© mi recompensa.",
            "16. Es horrible que me pase esto.",
            "17. Mi vida es un continuo fracaso.",
            "18. Siempre tendr√© este problema.",
            "19. S√© que me est√°n mintiendo y enga√±ando.",
            "20. ¬øY si me vuelvo loco y pierdo la cabeza?.",
            "21. Soy superior a la gente en casi todo.",
            "22. Yo soy responsable del sufrimiento de los que me rodean.",
            "23. Si me quisieran de verdad no me tratar√≠an as√≠.",
            "24. Me siento culpable, y es porque he hecho algo malo.",
            "25. Si tuviera m√°s apoyo no tendr√≠a estos problemas.",
            "26. Alguien que conozco es un imb√©cil.",
            "27. Otros tienen la culpa de lo que me pasa.",
            "28. No deber√≠a de cometer estos errores.",
            "29. No quiere reconocer que estoy en lo cierto.",
            "30. Ya vendr√°n mejores tiempos.",
            "31. Es insoportable, no puedo aguantar m√°s.",
            "32. Soy incompetente e in√∫til.",
            "33. Nunca podr√© salir de esta situaci√≥n.",
            "34. Quieren hacerme da√±o.",
            "35. ¬øY si les pasa algo malo a las personas a quienes quiero?.",
            "36. La gente hace las cosas mejor que yo.",
            "37. Soy una v√≠ctima de mis circunstancias.",
            "38. No me tratan como deber√≠an hacerlo y me merezco.",
            "39. Si tengo estos s√≠ntomas es porque soy un enfermo.",
            "40. Si tuviera mejor situaci√≥n econ√≥mica no tendr√≠a estos problemas.",
            "41. Soy un neur√≥tico.",
            "42. Lo que me pasa es un castigo que merezco.",
            "43. Deber√≠a recibir m√°s atenci√≥n y cari√±o de otros.",
            "44. Tengo raz√≥n, y voy a hacer lo que me da la gana.",
            "45. Tarde o temprano me ir√°n las cosas mejor."
        ];

        const factores = [
            "Filtraje", "Pensamiento Polarizado", "Sobregeneralizaci√≥n", "Interpretaci√≥n Pensamiento",
            "Visi√≥n Catastr√≥fica", "Personalizaci√≥n", "Falacia de Control", "Falacia de Justicia",
            "Razonamiento Emocional", "Falacia de Cambio", "Etiquetas Globales", "Culpabilidad",
            "Los Deber√≠as", "Falacia de Raz√≥n", "Falacia Recompensa Divina"
        ];

        let datosResultado = null;

        // === INICIALIZACI√ìN ===
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('fecha').valueAsDate = new Date();
            renderTable();
        });

        function renderTable() {
            const tbody = document.getElementById('questions-body');
            let html = '';
            
            preguntas.forEach((p, index) => {
                const num = index + 1;
                const texto = p.split('. ')[1]; // Quitar n√∫mero del string original si existe
                
                // Color alternado para filas
                const bgClass = num % 2 === 0 ? 'bg-slate-50' : 'bg-white';
                
                html += `
                <tr class="${bgClass} hover:bg-brand-50 transition-colors">
                    <td class="px-4 py-3 border-r border-slate-100">
                        <span class="text-xs font-bold text-slate-400 mr-1">${num}.</span>
                        <span class="text-slate-700 font-medium">${texto}</span>
                    </td>
                    ${[0, 1, 2, 3].map(val => `
                        <td class="p-0 text-center align-middle border-r border-slate-100 last:border-0 relative">
                            <label class="block w-full h-full py-4 cursor-pointer group">
                                <input type="radio" name="q${num}" value="${val}" class="peer sr-only">
                                <div class="w-8 h-8 mx-auto rounded-full border-2 border-slate-300 text-transparent 
                                            peer-checked:bg-brand-600 peer-checked:border-brand-600 peer-checked:text-white
                                            group-hover:border-brand-300 transition-all flex items-center justify-center font-bold">
                                    ${val}
                                </div>
                            </label>
                        </td>
                    `).join('')}
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        // === C√ÅLCULO DE RESULTADOS ===
        function calcularResultados() {
            // 1. Validar Identificaci√≥n
            const nombre = document.getElementById('nombre').value.trim();
            const grupo = document.getElementById('grupo').value.trim();
            const fecha = document.getElementById('fecha').value;

            if (!nombre || !grupo) {
                alert("‚ö†Ô∏è Por favor, ingresa tu Nombre y Grupo al inicio de la p√°gina.");
                document.getElementById('section-identity').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            // 2. Obtener respuestas y sumar
            let puntajes = []; // base 1
            let total = 0;
            let contestadas = 0;

            for (let i = 1; i <= 45; i++) {
                const opcion = document.querySelector(`input[name="q${i}"]:checked`);
                if (opcion) {
                    const val = parseInt(opcion.value);
                    puntajes[i] = val;
                    total += val;
                    contestadas++;
                }
            }

            // Validar completitud
            if (contestadas < 45) {
                alert(`‚ö†Ô∏è A√∫n faltan ${45 - contestadas} preguntas por responder.`);
                return;
            }

            // 3. Calcular Factores (L√≥gica: item i, i+15, i+30)
            let detalleFactores = [];
            for (let f = 0; f < 15; f++) {
                // Indices de preguntas (1-based)
                const q1 = f + 1;
                const q2 = f + 16;
                const q3 = f + 31;
                
                const suma = puntajes[q1] + puntajes[q2] + puntajes[q3];
                
                let nivel = "Bajo";
                if (suma >= 4 && suma <= 6) nivel = "Medio";
                if (suma >= 7) nivel = "Alto";

                detalleFactores.push({
                    nombre: factores[f],
                    suma: suma,
                    nivel: nivel
                });
            }

            // 4. Determinar Nivel Global
            let nivelGlobal = "BAJO";
            let colorGlobal = "bg-green-500";
            if (total > 45) { nivelGlobal = "MEDIO"; colorGlobal = "bg-yellow-500"; }
            if (total > 90) { nivelGlobal = "ALTO"; colorGlobal = "bg-red-600"; }

            // Guardar datos en memoria para WhatsApp
            datosResultado = {
                nombre, grupo, fecha, total, nivelGlobal, detalleFactores
            };

            // === RENDERIZAR RESULTADOS ===
            
            // Llenar tarjeta principal
            document.getElementById('res-nombre').innerText = `Alumno: ${nombre} (${grupo})`;
            document.getElementById('res-score').innerText = total;
            
            const badge = document.getElementById('res-badge');
            badge.className = `inline-block px-6 py-2 rounded-full text-sm font-bold tracking-wide text-white mb-6 ${colorGlobal}`;
            badge.innerText = `NIVEL DE DISTORSI√ìN: ${nivelGlobal}`;

            // Llenar Grid de Factores
            const grid = document.getElementById('factors-grid');
            grid.innerHTML = ''; // Limpiar

            detalleFactores.forEach((item, idx) => {
                // Estilos seg√∫n nivel
                let borderClass = "border-green-500";
                let bgClass = "bg-green-50";
                let textClass = "text-green-700";
                
                if (item.nivel === "Medio") {
                    borderClass = "border-yellow-500";
                    bgClass = "bg-yellow-50";
                    textClass = "text-yellow-700";
                } else if (item.nivel === "Alto") {
                    borderClass = "border-red-500";
                    bgClass = "bg-red-50";
                    textClass = "text-red-700";
                }

                grid.innerHTML += `
                    <div class="bg-white rounded-lg shadow-sm border-l-4 ${borderClass} p-4 flex justify-between items-center">
                        <div>
                            <span class="text-xs font-bold text-slate-400 uppercase block mb-1">Factor ${idx + 1}</span>
                            <h4 class="font-bold text-slate-800 text-sm">${item.nombre}</h4>
                        </div>
                        <div class="text-right">
                            <span class="block text-xl font-bold ${textClass}">${item.suma}</span>
                            <span class="text-[10px] font-bold uppercase tracking-wider ${textClass} bg-white px-2 py-0.5 rounded border border-current opacity-80">${item.nivel}</span>
                        </div>
                    </div>
                `;
            });

            // Mostrar Secci√≥n
            document.getElementById('section-identity').classList.add('opacity-50', 'pointer-events-none');
            document.getElementById('section-test').classList.add('hidden');
            document.getElementById('section-results').classList.remove('hidden');
            
            // Scroll arriba
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // === ENVIAR POR WHATSAPP ===
        function enviarWhatsApp() {
            if (!datosResultado) return;

            const d = datosResultado;
            
            // Filtrar distorsiones altas para resaltarlas en el mensaje
            const altas = d.detalleFactores.filter(f => f.nivel === "Alto").map(f => f.nombre);
            
            // Construir Mensaje
            let msg = `*RESULTADOS TEST IPA* üß†%0A`;
            msg += `üë§ *Alumno:* ${d.nombre}%0A`;
            msg += `üè´ *Grupo:* ${d.grupo}%0A`;
            msg += `üìÖ *Fecha:* ${d.fecha}%0A%0A`;
            
            msg += `üìä *Puntuaci√≥n Global:* ${d.total} (${d.nivelGlobal})%0A`;
            
            if (altas.length > 0) {
                msg += `‚ö†Ô∏è *Atenci√≥n Prioritaria en:*%0A`;
                altas.forEach(a => msg += `- ${a}%0A`);
            } else {
                msg += `‚úÖ Sin distorsiones cr√≠ticas.%0A`;
            }
            
            msg += `%0Aüìù *Detalle Completo:*%0A`;
            d.detalleFactores.forEach((f, i) => {
                // Solo enviamos si es medio o alto para no saturar el mensaje, o todos si se prefiere
                if(f.nivel !== "Bajo") {
                    msg += `${i+1}. ${f.nombre}: ${f.suma} (${f.nivel})%0A`;
                }
            });

            // Abrir API de WhatsApp
            window.open(`https://api.whatsapp.com/send?phone=${NUMERO_EVALUADOR}&text=${msg}`, '_blank');
        }
    </script>
</body>
</html>

